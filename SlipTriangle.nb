(* Content-type: application/vnd.wolfram.cdf.text *)

(*** Wolfram CDF File ***)
(* http://www.wolfram.com/cdf *)

(* CreatedBy='Mathematica 12.1' *)

(*************************************************************************)
(*                                                                       *)
(*                                                                       *)
(*  This file was created under the Wolfram Enterprise licensing terms.  *)
(*                                                                       *)
(*       For additional information concerning CDF licensing see:        *)
(*                                                                       *)
(*        www.wolfram.com/cdf/adopting-cdf/licensing-options.html        *)
(*                                                                       *)
(*                                                                       *)
(*                                                                       *)
(*************************************************************************)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[      1064,         20]
NotebookDataLength[    221671,       5093]
NotebookOptionsPosition[    215032,       4966]
NotebookOutlinePosition[    215425,       4982]
CellTagsIndexPosition[    215382,       4979]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Slipping of Triangular elements", "Title",
 CellChangeTimes->{{3.818943966836184*^9, 3.818944010245246*^9}, {
  3.818980434560214*^9, 
  3.818980462463352*^9}},ExpressionUUID->"ba979db3-0d81-4b25-aece-\
bc7347ec6e88"],

Cell[CellGroupData[{

Cell["Initialization Notation", "Section",
 InitializationCell->
  True,ExpressionUUID->"39740111-5994-46ae-b122-2ecea0d8fc03"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"get", " ", "association", " ", "of", " ", "resources"}], ",", 
    RowBox[{
    "name", " ", "of", " ", "local", " ", "host", " ", "and", " ", "remove", 
     " ", "local", " ", "host", " ", "from", " ", "available", " ", 
     "resources"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"hosts", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Counts", "[", 
        RowBox[{"ReadList", "[", 
         RowBox[{
          RowBox[{"Environment", "[", "\"\<NODEFILE\>\"", "]"}], ",", 
          "\"\<String\>\""}], "]"}], "]"}], "\n", "local"}], "=", 
      RowBox[{
       RowBox[{"First", "[", 
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"Environment", "[", "\"\<HOSTNAME\>\"", "]"}], ",", 
          "\"\<.\>\""}], "]"}], "]"}], "\n", 
       RowBox[{
        RowBox[{"hosts", "[", "local", "]"}], "--"}]}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "launch", " ", "subkernels", " ", "and", " ", "connect", " ", "them", 
      " ", "to", " ", "the", " ", "controlling", " ", "Wolfram", " ", 
      "Kernel"}], "*)"}], "\n", 
    RowBox[{"Needs", "[", "\"\<SubKernels`RemoteKernels`\>\"", "]"}], ";", 
    "\n", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"hosts", "[", "#", "]"}], ">", "0"}], ",", 
         RowBox[{"LaunchKernels", "[", 
          RowBox[{"RemoteMachine", "[", 
           RowBox[{
           "#", ",", 
            "\"\<ssh -x -f -l `3` `1` \
/gpfs/runtime/opt/mathematica/12.0/Executables/wolfram -wstp -linkmode \
Connect `4` -linkname '`2`' -subkernel -noinit\>\"", ",", 
            RowBox[{"hosts", "[", "#", "]"}]}], "]"}], "]"}]}], "]"}], "&"}], 
      ",", 
      RowBox[{"Keys", "[", "hosts", "]"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"dir", "=", 
     RowBox[{"DirectoryName", "[", "$InputFileName", "]"}]}], ";"}], 
   "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.802360809929325*^9, 3.80236081245658*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"f13c2ac7-6f36-4377-b4a4-b9f59cdc3109"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Out", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParallelEvaluate", "[", 
   RowBox[{"$HistoryLength", "=", "0"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "NDSolve`FEM`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dir", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetDirectory", "[", "dir", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.793312334920096*^9, 3.793312335372303*^9}, 
   3.7938826827907133`*^9, {3.793905408289299*^9, 3.793905408481564*^9}, {
   3.793908982920211*^9, 3.7939089930065527`*^9}, {3.79399050981011*^9, 
   3.793990521448658*^9}, {3.795819858911105*^9, 3.7958198712736673`*^9}, {
   3.795819918981234*^9, 3.795819933566794*^9}, 3.79588022360135*^9, {
   3.7959048476228952`*^9, 3.7959048480697813`*^9}, {3.795905242229089*^9, 
   3.795905245480752*^9}, {3.795905498874301*^9, 3.795905502427631*^9}, {
   3.795905923004134*^9, 3.7959059667771606`*^9}, {3.7960660619850388`*^9, 
   3.796066066072051*^9}, 3.796236472593124*^9, {3.796330583758168*^9, 
   3.796330590004838*^9}, 3.802389686543833*^9, 3.8024283079728456`*^9},
 CellLabel->"In[2]:=",ExpressionUUID->"15d1034f-f579-4da1-8e5f-d4922a9a75b4"],

Cell[BoxData["\<\"/Users/wenqiangfang/Dropbox \
(Brown)/Research/Synthetic_Plasticity\"\>"], "Output",
 CellChangeTimes->{
  3.8023896939724035`*^9, 3.802391543713554*^9, 3.802428062592033*^9, 
   3.802428304529634*^9, 3.8024307141650248`*^9, 3.8024351636704626`*^9, 
   3.802437306511454*^9, 3.802439743480308*^9, 3.802448773799799*^9, 
   3.802469650437962*^9, 3.802473377244585*^9, 3.802473778980896*^9, 
   3.8189372930472183`*^9, {3.818937483335882*^9, 3.818937483842353*^9}, 
   3.818937748157374*^9, 3.8189426524161367`*^9, 3.8189807218317327`*^9, 
   3.8190255751249332`*^9, 3.819036099922401*^9},
 CellLabel->"Out[7]=",ExpressionUUID->"f5e85cc7-a42d-4bca-9467-987df26bd7ff"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "PlotMeshBC", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"ShowMesh", ",", "ShowNumbers", ",", "ShowBCs"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotMeshBC", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ShowMesh", "\[Rule]", "False"}], ",", 
     RowBox[{"ShowNumbers", "\[Rule]", "False"}], ",", 
     RowBox[{"ShowBCs", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlotMeshBC", "[", 
     RowBox[{"mesh_", ",", "DirichletPoints_", ",", "NeumannPoints_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"OptionValue", "[", "ShowMesh", "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PltPoints", ",", "plt"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "ShowBCs", "]"}], 
           "\[IndentingNewLine]", ",", "\"\<DirichletBC\>\"", 
           "\[IndentingNewLine]", ",", 
           RowBox[{
            RowBox[{"PltPoints", " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"DirichletPoints", ",", 
                  RowBox[{"{", 
                   RowBox[{"#", ",", "_"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "ndof", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"plt", " ", "=", " ", "True"}], ";"}], 
           "\[IndentingNewLine]", ",", "\"\<NeumannBC\>\"", 
           "\[IndentingNewLine]", ",", 
           RowBox[{
            RowBox[{"PltPoints", " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"NeumannPoints", ",", 
                  RowBox[{"{", 
                   RowBox[{"#", ",", "_"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "ndof", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"plt", " ", "=", " ", "True"}], ";"}], 
           "\[IndentingNewLine]", ",", "False", "\[IndentingNewLine]", ",", 
           RowBox[{
            RowBox[{"plt", " ", "=", "False"}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Show", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"mesh", "[", "\"\<Wireframe\>\"", "]"}], "}"}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"OptionValue", "[", "ShowNumbers", "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mesh", "[", 
                  RowBox[{"\"\<Wireframe\>\"", "[", 
                   RowBox[{
                    RowBox[{
                    "\"\<MeshElement\>\"", " ", "->", " ", 
                    "\"\<MeshElements\>\""}], ",", 
                    RowBox[{
                    "\"\<MeshElementIDStyle\>\"", "\[Rule]", "Blue"}]}], 
                   "]"}], "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"mesh", "[", 
                  RowBox[{"\"\<Wireframe\>\"", "[", 
                   RowBox[{
                    RowBox[{
                    "\"\<MeshElement\>\"", " ", "->", " ", 
                    "\"\<PointElements\>\""}], ",", 
                    RowBox[{
                    "\"\<MeshElementIDStyle\>\"", "\[Rule]", "Red"}]}], "]"}],
                   "]"}]}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"plt", "\[IndentingNewLine]", ",", 
               RowBox[{"Switch", "[", 
                RowBox[{"ndof", "\[IndentingNewLine]", ",", "2", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Graphics", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PointSize", "[", "Large", "]"}], ",", "Orange", 
                    ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"Coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"PltPoints", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], 
                    "}"}], "]"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"Graphics", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PointSize", "[", "Large", "]"}], ",", "Green", 
                    ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"Coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"PltPoints", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]}], 
                    "}"}], "]"}]}], "}"}], "\[IndentingNewLine]", ",", "3", 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Graphics3D", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PointSize", "[", "Large", "]"}], ",", "Orange", 
                    ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"Coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"PltPoints", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], 
                    "}"}], "]"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"Graphics3D", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PointSize", "[", "Large", "]"}], ",", "Green", 
                    ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"Coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"PltPoints", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]}], 
                    "}"}], "]"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"Graphics3D", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PointSize", "[", "Large", "]"}], ",", "Purple", 
                    ",", 
                    RowBox[{"Opacity", "[", "0.3", "]"}], ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"Coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"PltPoints", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "]"}]}], 
                    "}"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
               ",", 
               RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"ViewPoint", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"1.5", ",", "1", ",", "1"}], "}"}]}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ",", "Null"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintBB", "[", "X_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"#", ",", "Blue", ",", "Bold"}], "]"}], "&"}], "/@", "X"}],
         ")"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintRB", "[", "X_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"#", ",", "Red", ",", "Bold"}], "]"}], "&"}], "/@", "X"}], 
        ")"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{
  3.795879210168948*^9, {3.795880179847405*^9, 3.7958801799678793`*^9}, {
   3.795880674748226*^9, 3.79588067630155*^9}, 3.795880823435541*^9, {
   3.795886637660981*^9, 3.795886676866068*^9}, {3.7958867078284616`*^9, 
   3.795886752333523*^9}, {3.7958896783963413`*^9, 3.795889678719018*^9}, {
   3.795895521640162*^9, 3.795895521838162*^9}, {3.795904829284689*^9, 
   3.795904829363648*^9}, {3.802363003749601*^9, 3.802363027700346*^9}, {
   3.818943463388913*^9, 3.818943469126165*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"83f6da20-202e-4799-bc57-3420348dd756"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Problem Solution: Numerics", "Section",
 InitializationCell->True,
 CellChangeTimes->{
  3.714862195345368*^9, {3.714994487379437*^9, 3.714994497965662*^9}, {
   3.715355858428784*^9, 
   3.715355874968198*^9}},ExpressionUUID->"130d897e-c75f-4858-aa37-\
bf3a2be32e6f"],

Cell[CellGroupData[{

Cell["Boundary condition", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.715355912120022*^9, 3.7153559160793324`*^9}, 
   3.715356088427513*^9, {3.802363542464201*^9, 
   3.802363546239861*^9}},ExpressionUUID->"c7d98378-1c8c-4c0c-9cdd-\
7c9ebac71b21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"DefineBCs", ",", "Edgedet"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DefineBCs", "[", 
   RowBox[{"uVec_", ",", "tVec_", ",", "L_", ",", "r_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"tol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], ",", "IDArray"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DirichletPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Bttm", ",", "BttmRit", ",", "Lft", ",", "Bck", ",", "Rit", ",", 
          "RitBttm", ",", "Tp", ",", "Nodes"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Bttm", " ", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{
                RowBox[{"Coords", "[", 
                 RowBox[{"[", 
                  RowBox[{";;", ",", "3"}], "]"}], "]"}], "-", "0.0"}], "]"}],
               ",", 
              RowBox[{"x_", "/;", 
               RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Lft", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", 
               RowBox[{"(", 
                RowBox[{"-", "r"}], ")"}]}], "]"}], ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Bck", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "1"}], "]"}], "]"}], "-", 
               RowBox[{"(", 
                RowBox[{"-", "r"}], ")"}]}], "]"}], ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Nodes", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Bck"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Lft"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}]}], 
            "]"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}]}], 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}]}], 
            "*)"}], "]"}]}]}]}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Nodes", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", 
            RowBox[{"Extract", "[", 
             RowBox[{"Rit", ",", "RitBttm"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", 
            RowBox[{"Extract", "[", 
             RowBox[{"Bttm", ",", "BttmRit"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Tp"}]}], "]"}]}], 
        "*)"}], "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DirichletDof", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DirichletPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"DirichletPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NeumannPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Tp", ",", "Rit", ",", "Frnt", ",", "ETp", ",", "ERit", ",", "EFrnt",
           ",", "Nodes"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Tp", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{
                RowBox[{"Coords", "[", 
                 RowBox[{"[", 
                  RowBox[{";;", ",", "3"}], "]"}], "]"}], "-", "L"}], "]"}], 
              ",", 
              RowBox[{"x_", "/;", 
               RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Rit", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", 
               RowBox[{"(", "r", ")"}]}], "]"}], ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Frnt", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "1"}], "]"}], "]"}], "-", 
               RowBox[{"(", "r", ")"}]}], "]"}], ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ETp", "=", 
          RowBox[{"Edgedet", "@", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ERit", "=", 
          RowBox[{"Edgedet", "@", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"EFrnt", "=", 
          RowBox[{"Edgedet", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Edges", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "EFrnt"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "ERit"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", "#"}], "}"}], "&"}], "/@", "ETp"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Nodes", " ", "=", "  ", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"3", ",", "#"}], "}"}], "&"}], "/@", "Tp"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Frnt"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Rit"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", "#"}], "}"}], "&"}], "/@", "Tp"}]}], 
           "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NeumannDof", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NeumannPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"NeumannPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DirichletVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"uVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "DirichletPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NeumannVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"tVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "NeumannPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDArray", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"ndof", "*", "nnp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDMat", "=", 
      SuperscriptBox[
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"IDArray", ",", 
         RowBox[{"{", 
          RowBox[{"nnp", ",", "ndof"}], "}"}]}], "]"}], "\[Transpose]"]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"IDno", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"IDArray", ",", "DirichletDof"}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Edgedet", "[", "n_", "]"}], ":=", 
   RowBox[{"Extract", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"mesh", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{"Position", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Norm", "@", 
           RowBox[{"(", 
            RowBox[{"#", "-", "n"}], ")"}]}], "&"}], ",", 
         RowBox[{
          RowBox[{"mesh", "[", "\"\<BoundaryNormals\>\"", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"x_", "/;", 
        RowBox[{"x", "<", 
         SuperscriptBox["10", 
          RowBox[{"-", "5"}]]}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DefineBCs1", "[", 
   RowBox[{"uVec_", ",", "tVec_", ",", "L_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"tol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], ",", "IDArray"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DirichletPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Bttm", ",", "BttmRit", ",", "Lft", ",", "Bck", ",", "Rit", ",", 
          "RitBttm", ",", "Tp", ",", "Nodes"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Bttm", " ", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "0.0"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}]}], 
           "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DirichletDof", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DirichletPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"DirichletPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NeumannPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Tp", ",", "Rit", ",", "Frnt", ",", "ETp", ",", "ERit", ",", "EFrnt",
           ",", "Nodes"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Tp", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "L"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Tp"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NeumannDof", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NeumannPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"NeumannPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DirichletVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"uVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "DirichletPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NeumannVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"tVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "NeumannPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDArray", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"ndof", "*", "nnp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDMat", "=", 
      SuperscriptBox[
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"IDArray", ",", 
         RowBox[{"{", 
          RowBox[{"nnp", ",", "ndof"}], "}"}]}], "]"}], "\[Transpose]"]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"IDno", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"IDArray", ",", "DirichletDof"}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7933128690953608`*^9, 3.79331291577356*^9}, {
   3.793312992904749*^9, 3.793313016496355*^9}, {3.793313064259726*^9, 
   3.793313088914152*^9}, {3.79331346349664*^9, 3.7933134637267523`*^9}, {
   3.79336139928608*^9, 3.793361425043112*^9}, {3.79336153785701*^9, 
   3.793361553192354*^9}, {3.7938026706775017`*^9, 3.793802746109132*^9}, {
   3.793802819867404*^9, 3.793802827033334*^9}, {3.793802872598412*^9, 
   3.793802874243579*^9}, 3.79380576231275*^9, 3.793878960880723*^9, 
   3.793882810286756*^9, {3.793905837384344*^9, 3.7939059337209587`*^9}, {
   3.793915382862303*^9, 3.7939153957353783`*^9}, {3.7939154952835493`*^9, 
   3.7939155058055553`*^9}, {3.793915853094071*^9, 3.793915887756075*^9}, {
   3.793917261959423*^9, 3.79391726281308*^9}, {3.793917372386855*^9, 
   3.793917372535695*^9}, {3.7939177725024977`*^9, 3.793917790324416*^9}, {
   3.793917945467057*^9, 3.793917951575436*^9}, {3.793918005830113*^9, 
   3.793918079897683*^9}, 3.7939183362785673`*^9, {3.793918463296001*^9, 
   3.7939184664115334`*^9}, {3.79396995026427*^9, 3.793969950413603*^9}, {
   3.794062919311406*^9, 3.794062945029703*^9}, 3.794063112230834*^9, {
   3.795786097358336*^9, 3.795786099147805*^9}, {3.795786132740712*^9, 
   3.7957861364545813`*^9}, {3.795786239489691*^9, 3.795786267825686*^9}, {
   3.7958199814429483`*^9, 3.795819990233027*^9}, {3.7958203785953627`*^9, 
   3.7958203791724167`*^9}, {3.7958226672483273`*^9, 
   3.7958228592304153`*^9}, {3.795880179678753*^9, 3.7958801797979794`*^9}, {
   3.795880671161191*^9, 3.795880672537677*^9}, {3.795881155926774*^9, 
   3.7958811620922403`*^9}, {3.795882166219293*^9, 3.795882168739482*^9}, {
   3.7958822562156897`*^9, 3.795882275280779*^9}, {3.795882332762142*^9, 
   3.795882374625795*^9}, {3.795882441106523*^9, 3.7958824751809177`*^9}, {
   3.795886979406479*^9, 3.795886996057416*^9}, 3.795889662732875*^9, {
   3.7959005395952873`*^9, 3.795900552868064*^9}, {3.7959048286016817`*^9, 
   3.7959048294932203`*^9}, 3.795906028044039*^9, {3.795906143052659*^9, 
   3.795906155600444*^9}, {3.7959558819048147`*^9, 3.795955893304747*^9}, {
   3.795956196107472*^9, 3.7959561975144053`*^9}, {3.795956888664124*^9, 
   3.7959568913261023`*^9}, {3.795992354685123*^9, 3.795992379581403*^9}, {
   3.795992426060546*^9, 3.795992519288025*^9}, {3.795992550505309*^9, 
   3.7959926272914753`*^9}, {3.7959929023784027`*^9, 3.79599306784347*^9}, 
   3.796063199298278*^9, {3.796065340556273*^9, 3.7960653579198647`*^9}, {
   3.796067256680646*^9, 3.796067258479739*^9}, {3.796068328461707*^9, 
   3.796068389324016*^9}, 3.796078147536273*^9, 3.79648092960627*^9, {
   3.796481094499892*^9, 3.7964812094075813`*^9}, {3.796481293081335*^9, 
   3.7964813010491962`*^9}, {3.796481334229938*^9, 3.796481365672316*^9}, {
   3.796481400964314*^9, 3.796481486024016*^9}, {3.796481600267243*^9, 
   3.796481629772444*^9}, {3.796481724457328*^9, 3.79648173068032*^9}, {
   3.796481852966515*^9, 3.796481857132618*^9}, 3.7964819035527277`*^9, {
   3.7964824912093477`*^9, 3.796482501481773*^9}, {3.796497111085197*^9, 
   3.796497112427369*^9}, {3.796551627548842*^9, 3.7965516999396477`*^9}, 
   3.7965517381324377`*^9, {3.7965632348112183`*^9, 3.7965632357991953`*^9}, {
   3.8023614430684433`*^9, 3.8023614478614798`*^9}, {3.8023617125618763`*^9, 
   3.802361751799253*^9}, {3.802361795160993*^9, 3.802361862620096*^9}, {
   3.802362266984426*^9, 3.802362287313491*^9}, {3.8023623543799553`*^9, 
   3.802362423691372*^9}, {3.8023631545894527`*^9, 3.8023631548096952`*^9}, 
   3.802363307999629*^9, {3.802363917400374*^9, 3.802363917517313*^9}, {
   3.802378832492096*^9, 3.802378844318882*^9}, {3.802379052395297*^9, 
   3.8023791090832233`*^9}, {3.802384527078924*^9, 3.8023845745147963`*^9}, {
   3.8023851695955553`*^9, 3.802385172763948*^9}, {3.802427984374377*^9, 
   3.8024280193947163`*^9}, {3.802428153916391*^9, 3.802428196866933*^9}, {
   3.802430116825486*^9, 3.8024301595740004`*^9}, {3.802430303423008*^9, 
   3.802430397319691*^9}, 3.80243048865156*^9, {3.8024305338058014`*^9, 
   3.802430534440477*^9}, 3.802430602736843*^9, {3.8024306457050843`*^9, 
   3.8024306556378365`*^9}, {3.802433067115697*^9, 3.8024330673733416`*^9}, {
   3.8024331000902414`*^9, 3.802433339613818*^9}, {3.802433754581504*^9, 
   3.80243382869692*^9}, 3.8024348487431326`*^9, {3.802435103143508*^9, 
   3.8024351089973917`*^9}, {3.8024408173626633`*^9, 3.802440823718977*^9}, {
   3.802441127882394*^9, 3.802441130526922*^9}, {3.818937918929789*^9, 
   3.818937930290505*^9}, {3.818942635825519*^9, 3.8189426361198063`*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"d001b27c-9aad-47e5-b41f-c679d423578d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Apply Traction", "Subsection",
 CellChangeTimes->{{3.802371026127304*^9, 
  3.8023710323525047`*^9}},ExpressionUUID->"4a9a92f0-59be-4b38-9fbd-\
8ed3f91230aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ApplyTraction", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ApplyTraction", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ApplyTraction", "[", 
   RowBox[{"rMat_", ",", "edge_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ElementType", "=", 
       RowBox[{"Head", "@", 
        RowBox[{
         RowBox[{"mesh", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"elementOrder", "=", 
       RowBox[{"mesh", "[", "\"\<MeshOrder\>\"", "]"}]}], ",", 
      "\[IndentingNewLine]", "integrationOrder", ",", "\[IndentingNewLine]", 
      RowBox[{"ELEtMat", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ndof", ",", "nsen"}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", ",", "OutEdge", ",", "coord", ",", "jacobi", ",",
       "ELEt", ",", "Q", "\[IndentingNewLine]", ",", "GuassPointsNatural", 
      ",", "GuassWeights", ",", "NMat", ",", "dN", ",", "NetTrctn"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"integrationOrder", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ElementType", "===", "QuadElement"}], ",", 
        RowBox[{"2", "elementOrder"}], ",", "elementOrder"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"GuassPointsNatural", "=", 
      RowBox[{"ElementIntegrationPoints", "[", 
       RowBox[{"ElementType", ",", "integrationOrder"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"GuassWeights", "=", 
      RowBox[{"ElementIntegrationWeights", "[", 
       RowBox[{"ElementType", ",", "integrationOrder"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NMat", "=", 
      RowBox[{"ElementShapeFunction", "[", 
       RowBox[{"ElementType", ",", "elementOrder"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dN", "=", " ", 
      RowBox[{"ElementShapeFunctionDerivative", "[", 
       RowBox[{"ElementType", ",", "elementOrder"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"OutEdge", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Outer", "[", 
           RowBox[{"List", ",", 
            RowBox[{"Range", "[", "ndof", "]"}], ",", "Edge"}], "]"}], ",", 
          "1"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"OutEdge", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"edge", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "}"}], "&"}], "/@", 
       RowBox[{"edge", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coord", " ", "=", 
      RowBox[{"Coords", "[", 
       RowBox[{"[", 
        RowBox[{"edge", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"jacobi", " ", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndof", "\[Equal]", "3"}], ",", 
        RowBox[{
         RowBox[{"Norm", "[", 
          RowBox[{"Cross", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], ")"}]}], 
          "]"}], "&"}], "\[IndentingNewLine]", ",", 
        RowBox[{
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ELEtMat", "=", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ELEtMat", ",", 
        RowBox[{
         RowBox[{"edge", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "->", 
         RowBox[{"Map", "[", 
          RowBox[{"NeumannBC", ",", "OutEdge"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ELEtMat", "=", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{
          RowBox[{"ReplacePart", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{"NeumannBC", ",", "OutEdge"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"KeyExistsQ", "[", 
                  RowBox[{"NeumannBC", ",", "#"}], "]"}], "&"}], "/@", 
                "OutEdge"}], ",", "False"}], "]"}], "\[Rule]", "0.0"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"ndof", ",", "nsen"}], "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ELEt", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"jacobi", "[", "#", "]"}], 
        RowBox[{"(", 
         RowBox[{"ELEtMat", ".", 
          RowBox[{"NMat", "@@", "#"}]}], ")"}]}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NetTrctn", "=", 
      RowBox[{"GuassWeights", ".", 
       RowBox[{"(", 
        RowBox[{"ELEt", "/@", "GuassPointsNatural"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Q", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"IDMat", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", 
          RowBox[{"edge", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rMat", "[", 
       RowBox[{"[", "Q", "]"}], "]"}], "+=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"#", "/", "nsen"}], ",", "nsen"}], "]"}], "&"}], "/@", 
        "NetTrctn"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{
  3.793916025415016*^9, {3.7958791722192163`*^9, 3.795879180562128*^9}, 
   3.795880674026186*^9, {3.795887251487945*^9, 3.7958872524043818`*^9}, 
   3.7959007844535923`*^9, {3.796060215644723*^9, 3.796060234908806*^9}, {
   3.796060371537204*^9, 3.796060451306954*^9}, {3.7960605988891077`*^9, 
   3.796060655609076*^9}, 3.796060742101644*^9, {3.796060994669973*^9, 
   3.7960609948368883`*^9}, {3.796063316625821*^9, 3.796063319372518*^9}, {
   3.796063472852573*^9, 3.79606347557058*^9}, {3.796063534845563*^9, 
   3.79606354137468*^9}, {3.7960644762415543`*^9, 3.79606452434795*^9}, 
   3.7960649635224257`*^9, {3.796065247361752*^9, 3.796065250211748*^9}, 
   3.802366806124955*^9, 3.802391515574026*^9, {3.8023916198540263`*^9, 
   3.802391626284623*^9}, 3.8023927166247067`*^9, 3.802432358899727*^9, 
   3.8024333528287926`*^9, {3.8024336804921875`*^9, 3.8024336875629873`*^9}, {
   3.8024337318116713`*^9, 3.8024337340589275`*^9}, {3.80243401496541*^9, 
   3.8024340235393424`*^9}, {3.8024346431504564`*^9, 3.8024347314445653`*^9}, 
   3.8024348322433605`*^9, {3.802472199380077*^9, 3.802472199690831*^9}, {
   3.8024722472600527`*^9, 3.8024722848849163`*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"98d46118-fccd-42e9-a104-64bd1a74173f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Neo-Hookean Constitutive law", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.715355912120022*^9, 3.7153559160793324`*^9}, 
   3.715356088427513*^9, {3.802369561925823*^9, 
   3.802369569207073*^9}},ExpressionUUID->"063a9aa6-8702-40e0-94a8-\
0d87520eb80b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Kirchhoff", "[", 
    RowBox[{"e0_", ",", 
     RowBox[{"BMat", ":", "_"}], ",", 
     RowBox[{"ELEu", ":", "_"}], ",", "\[Xi]_List"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"e", "=", "e0"}], "\[IndentingNewLine]", ",", "F", ",", "J", 
       ",", "B", ",", "TrB", ",", "\[Sigma]", ",", "\[Tau]", 
       "\[IndentingNewLine]", ",", "\[CapitalEpsilon]", ",", "\[Nu]", ",", 
       "\[CapitalKappa]", ",", "\[Lambda]", ",", "\[Mu]"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[CapitalEpsilon]", ",", "\[Nu]", ",", "\[CapitalKappa]", ",", 
         "\[Lambda]", ",", "\[Mu]"}], "}"}], "=", "MaterialProperty"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{"\[ScriptCapitalI]", "+", 
        RowBox[{
         RowBox[{"BMat", "[", "\[Xi]", "]"}], ".", "ELEu"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"J", "=", 
       RowBox[{"Det", "[", "F", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B", "=", 
       RowBox[{"F", ".", 
        SuperscriptBox["F", "\[Transpose]"]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"TrB", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndof", "\[Equal]", "3"}], ",", 
         RowBox[{"Tr", "[", "B", "]"}], ",", 
         RowBox[{
          RowBox[{"Tr", "[", "B", "]"}], "+", "1"}]}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "difference", " ", "in", " ", "3", "D", " ", "and", " ", "2", "D"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Sigma]", "=", " ", 
       RowBox[{
        RowBox[{
         FractionBox["\[Mu]", 
          SuperscriptBox["J", 
           RowBox[{"5", "/", "3"}]]], 
         RowBox[{"(", 
          RowBox[{"B", "-", 
           RowBox[{
            FractionBox["TrB", "3"], "\[ScriptCapitalI]"}]}], ")"}]}], "+", 
        RowBox[{"\[CapitalKappa]", 
         RowBox[{"(", 
          RowBox[{"J", "-", "1"}], ")"}], "\[ScriptCapitalI]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Tau]", " ", "=", " ", 
       RowBox[{"J", " ", "\[Sigma]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Tangent", "[", 
   RowBox[{"e0_", ",", 
    RowBox[{"BMat", ":", "_"}], ",", 
    RowBox[{"ELEu", ":", "_"}], ",", "\[Xi]_List"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"e", "=", "e0"}], "\[IndentingNewLine]", ",", "F", ",", "J", 
      ",", "B", ",", "TrB", ",", "\[Sigma]", ",", "\[Tau]", 
      "\[IndentingNewLine]", ",", "\[CapitalEpsilon]", ",", "\[Nu]", ",", 
      "\[CapitalKappa]", ",", "\[Lambda]", ",", "\[Mu]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[CapitalEpsilon]", ",", "\[Nu]", ",", "\[CapitalKappa]", ",", 
        "\[Lambda]", ",", "\[Mu]"}], "}"}], "=", "MaterialProperty"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"F", "=", 
      RowBox[{"\[ScriptCapitalI]", "+", 
       RowBox[{
        RowBox[{"BMat", "[", "\[Xi]", "]"}], ".", "ELEu"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"J", "=", 
      RowBox[{"Det", "[", "F", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B", "=", 
      RowBox[{"F", ".", 
       SuperscriptBox["F", "\[Transpose]"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"TrB", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndof", "\[Equal]", "3"}], ",", 
        RowBox[{"Tr", "[", "B", "]"}], ",", 
        RowBox[{
         RowBox[{"Tr", "[", "B", "]"}], "+", "1"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "difference", " ", "in", " ", "3", "D", " ", "and", " ", "2", "D"}], 
      "*)"}], "\[IndentingNewLine]", " ", 
     RowBox[{
      RowBox[{
       FractionBox["\[Mu]", 
        SuperscriptBox["J", 
         RowBox[{"2", "/", "3"}]]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"\[ScriptCapitalI]", "\[TensorProduct]", "B"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}]}], "]"}], "+", 
         
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"B", "\[TensorProduct]", "\[ScriptCapitalI]"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "4", ",", "2"}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", "-", 
         RowBox[{
          FractionBox["2", "3"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"B", "\[TensorProduct]", "\[ScriptCapitalI]"}], "+", 
            RowBox[{"\[ScriptCapitalI]", "\[TensorProduct]", "B"}]}], ")"}]}],
          "+", 
         RowBox[{
          FractionBox["2", "3"], 
          FractionBox["TrB", "3"], 
          RowBox[{
          "\[ScriptCapitalI]", "\[TensorProduct]", "\[ScriptCapitalI]"}]}]}], 
        ")"}]}], "+", 
      RowBox[{"\[CapitalKappa]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", "J"}], "-", "1"}], ")"}], "J", " ", 
       RowBox[{
       "\[ScriptCapitalI]", "\[TensorProduct]", "\[ScriptCapitalI]"}]}]}]}]}],
    "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.79379931191206*^9, 3.793799321924858*^9}, {
   3.7938026499079437`*^9, 3.793802657284236*^9}, 3.793802757555758*^9, {
   3.793803022906185*^9, 3.7938030240554733`*^9}, {3.793818322836081*^9, 
   3.793818324923881*^9}, {3.7938188373763247`*^9, 3.7938188494602747`*^9}, {
   3.793818919030777*^9, 3.793819099018301*^9}, {3.7938191511657352`*^9, 
   3.793819161287521*^9}, {3.793819220016695*^9, 3.793819243579015*^9}, {
   3.7938193058517437`*^9, 3.793819306012527*^9}, {3.793819360348468*^9, 
   3.793819413935884*^9}, {3.793819503690083*^9, 3.793819512408924*^9}, {
   3.793819618317604*^9, 3.793819618790148*^9}, {3.793823359316804*^9, 
   3.793823557339525*^9}, 3.793823618756562*^9, {3.793823658450313*^9, 
   3.793823663738381*^9}, {3.793823732920004*^9, 3.793823752046591*^9}, {
   3.793823866946508*^9, 3.793823922646328*^9}, {3.7938240858058033`*^9, 
   3.793824090770051*^9}, 3.793824176452223*^9, {3.7938279195169067`*^9, 
   3.793827950164743*^9}, {3.7938281287872543`*^9, 3.7938281289408903`*^9}, {
   3.793828423077054*^9, 3.793828448372067*^9}, {3.793828693080078*^9, 
   3.793828698814808*^9}, {3.793829873276657*^9, 3.793829886371854*^9}, {
   3.793829959058312*^9, 3.793829966869896*^9}, {3.793830013315276*^9, 
   3.7938300724747868`*^9}, {3.793830229421747*^9, 3.7938302468388987`*^9}, 
   3.793831006585548*^9, 3.793832191655521*^9, {3.793879956942214*^9, 
   3.793879962702729*^9}, {3.7938800820984297`*^9, 3.793880084232415*^9}, {
   3.7938819694382963`*^9, 3.793882001380637*^9}, {3.793882301437009*^9, 
   3.7938823490009947`*^9}, {3.7938826277242603`*^9, 3.793882644606277*^9}, {
   3.793882730256043*^9, 3.793882764517743*^9}, {3.793882795576111*^9, 
   3.7938827958484087`*^9}, {3.793899753106295*^9, 3.793899796835475*^9}, 
   3.7938998729748993`*^9, {3.793899910112266*^9, 3.793899949028701*^9}, {
   3.79390477083386*^9, 3.7939047833040457`*^9}, {3.7939050084043303`*^9, 
   3.793905044119135*^9}, {3.793905106397538*^9, 3.793905109369996*^9}, {
   3.793905168768341*^9, 3.793905175307379*^9}, {3.793905238651765*^9, 
   3.7939052396712303`*^9}, {3.793905432405058*^9, 3.793905433917614*^9}, {
   3.793905467375022*^9, 3.793905467694049*^9}, {3.79390887919205*^9, 
   3.7939088919706984`*^9}, {3.793908976997305*^9, 3.793908978552463*^9}, {
   3.793909069868248*^9, 3.793909079694229*^9}, {3.793915557943563*^9, 
   3.793915572216188*^9}, 3.793992145573971*^9, {3.7939922490545673`*^9, 
   3.7939922668707647`*^9}, 3.79399239854274*^9, 3.7939928830787992`*^9, {
   3.794502074525782*^9, 3.7945020769637413`*^9}, {3.7945021253657017`*^9, 
   3.794502129399186*^9}, {3.794503388166778*^9, 3.794503388309278*^9}, {
   3.79573361919027*^9, 3.7957336310096483`*^9}, {3.795777889375539*^9, 
   3.795778018657298*^9}, {3.795778056892716*^9, 3.795778267560968*^9}, {
   3.7957806219222107`*^9, 3.795780628758252*^9}, {3.795780671214394*^9, 
   3.795780758591855*^9}, 3.7957808280216293`*^9, {3.7957808654378033`*^9, 
   3.795780872549623*^9}, {3.795780919532342*^9, 3.795781027096139*^9}, {
   3.7957811021305513`*^9, 3.795781135952263*^9}, {3.795781196484262*^9, 
   3.7957812140215*^9}, {3.795781286537505*^9, 3.795781313225604*^9}, {
   3.795781496036799*^9, 3.79578150354251*^9}, {3.795781535625558*^9, 
   3.79578188887029*^9}, {3.7957819429921513`*^9, 3.7957819734499693`*^9}, {
   3.795782026211289*^9, 3.7957820330598392`*^9}, 3.795782070685536*^9, {
   3.795782170456547*^9, 3.7957823841902523`*^9}, {3.7957824228869677`*^9, 
   3.7957824331945267`*^9}, {3.795783179583858*^9, 3.79578331949207*^9}, {
   3.795783349895584*^9, 3.795783382663109*^9}, {3.795783536095377*^9, 
   3.795783586194017*^9}, {3.795783641400827*^9, 3.795783645002124*^9}, {
   3.795783679164527*^9, 3.795783732028511*^9}, {3.795783876260932*^9, 
   3.79578387934365*^9}, {3.795783916233993*^9, 3.795783928954294*^9}, {
   3.795785335984273*^9, 3.795785399320273*^9}, {3.795785429992106*^9, 
   3.795785617176581*^9}, {3.795785870199499*^9, 3.795785875957467*^9}, {
   3.795785932831031*^9, 3.795785938239416*^9}, {3.795786411672879*^9, 
   3.7957865860913754`*^9}, {3.795797686027384*^9, 3.795797700536025*^9}, {
   3.795797751952907*^9, 3.795797756143955*^9}, {3.795797829099365*^9, 
   3.795797829842966*^9}, {3.79579834349876*^9, 3.795798378450014*^9}, {
   3.795798603684132*^9, 3.795798614170775*^9}, {3.795798648990285*^9, 
   3.7957986749488497`*^9}, {3.795801851622417*^9, 3.795801851761417*^9}, {
   3.795802364338839*^9, 3.795802436071003*^9}, {3.7958024709042807`*^9, 
   3.7958026898299932`*^9}, 3.795802916798677*^9, {3.7958035994777203`*^9, 
   3.795803612032751*^9}, {3.795803685255919*^9, 3.795803685836141*^9}, {
   3.795803858356011*^9, 3.7958039660822372`*^9}, {3.79580404649375*^9, 
   3.795804047260911*^9}, {3.7958065300797577`*^9, 3.795806530293572*^9}, {
   3.795879347355385*^9, 3.7958793653542023`*^9}, 3.7958802634904003`*^9, 
   3.795880672687652*^9, {3.795883938765883*^9, 3.7958840464813223`*^9}, 
   3.7958841808590508`*^9, {3.795884236303364*^9, 3.795884249980742*^9}, {
   3.795885151365014*^9, 3.795885190468073*^9}, {3.795887782739728*^9, 
   3.795887828345722*^9}, {3.795887922484715*^9, 3.795887998714909*^9}, {
   3.795888155202167*^9, 3.795888273690391*^9}, {3.795888445358398*^9, 
   3.795888472945013*^9}, {3.795888525477249*^9, 3.795888548636663*^9}, {
   3.7958886329616623`*^9, 3.795888674382325*^9}, {3.795888746720894*^9, 
   3.795888778042913*^9}, {3.7958888627189703`*^9, 3.795888934567218*^9}, {
   3.795889019132669*^9, 3.7958890870297832`*^9}, {3.795889315179902*^9, 
   3.79588931972373*^9}, {3.795889919348316*^9, 3.795889922228978*^9}, {
   3.7958899806600523`*^9, 3.7958900061355143`*^9}, {3.79589095080135*^9, 
   3.7958909644782124`*^9}, {3.795891039607979*^9, 3.795891097387055*^9}, {
   3.79589123839178*^9, 3.795891431144162*^9}, 3.795891492337728*^9, 
   3.7958916164533663`*^9, {3.79589175500106*^9, 3.795891875571826*^9}, {
   3.79589205758032*^9, 3.795892063961215*^9}, 3.795892281962435*^9, {
   3.795892485768635*^9, 3.795892486723351*^9}, {3.795893722108527*^9, 
   3.795893723044939*^9}, {3.795894425084964*^9, 3.7958944560049963`*^9}, 
   3.79589479350848*^9, {3.7959006379629793`*^9, 3.79590064366969*^9}, {
   3.79590482561771*^9, 3.795904829839587*^9}, {3.795905130378098*^9, 
   3.79590514331712*^9}, {3.795905241108493*^9, 3.7959052455445843`*^9}, {
   3.795905441658678*^9, 3.795905442966086*^9}, {3.7959058063967733`*^9, 
   3.795905813921311*^9}, 3.7959060484989853`*^9, {3.796418801826559*^9, 
   3.796418837993086*^9}, {3.7964188723452663`*^9, 3.796418913773726*^9}, 
   3.802368666053472*^9, {3.802368696782609*^9, 3.8023687403590527`*^9}, {
   3.8023688280418043`*^9, 3.802368850303918*^9}, {3.80236891373044*^9, 
   3.802369019331334*^9}, {3.802369059180295*^9, 3.802369113067621*^9}, {
   3.802369183986133*^9, 3.8023692102075777`*^9}, {3.8023693662656813`*^9, 
   3.802369377622818*^9}, {3.802369433617861*^9, 3.8023695215780697`*^9}, {
   3.8023696680138187`*^9, 3.802369746526853*^9}, {3.80236982250523*^9, 
   3.802369883571457*^9}, {3.802369934339603*^9, 3.802369997582877*^9}, 
   3.802370040167263*^9, {3.8023710972049932`*^9, 3.802371120851162*^9}, {
   3.802373668210516*^9, 3.8023736710552883`*^9}, {3.8023737266587143`*^9, 
   3.8023737287025003`*^9}, {3.802374359794438*^9, 3.802374434123877*^9}, {
   3.802384106973187*^9, 3.802384110683495*^9}, {3.8023841502994747`*^9, 
   3.802384156548224*^9}, {3.8023842278486967`*^9, 3.8023843057369967`*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"78f28d6b-52e4-4baf-991a-20c8d0d8ed15"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Stiffness and  Residual", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.715355912120022*^9, 3.7153559160793324`*^9}, 
   3.715356088427513*^9, {3.802371040590355*^9, 
   3.802371049856557*^9}},ExpressionUUID->"ca2ed7d2-70d5-4084-b8f4-\
66d5518f62c8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"DefineGaussAndSFInfo", ",", "GuassIntegrate"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DefineGaussAndSFInfo", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"ReducedIntegration", "\[Rule]", "False"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DefineGaussAndSFInfo", "[", 
    RowBox[{"ElementType_", ",", "elementOrder_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"integrationOrder", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"!", 
           RowBox[{"OptionValue", "[", "ReducedIntegration", "]"}]}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ElementType", "===", "HexahedronElement"}], ")"}], "||", 
            RowBox[{"(", 
             RowBox[{"ElementType", "===", "QuadElement"}], ")"}]}], ")"}]}], 
         ",", 
         RowBox[{"2", "elementOrder"}], ",", "elementOrder"}], "]"}]}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"GuassPointsNatural", "=", 
       RowBox[{"ElementIntegrationPoints", "[", 
        RowBox[{"ElementType", ",", "integrationOrder"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"GaussIndex", "=", 
         RowBox[{"AssociationMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"GuassPointsNatural", ",", "#"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}], ",", 
           "GuassPointsNatural"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"GuassWeights", "=", 
       RowBox[{"ElementIntegrationWeights", "[", 
        RowBox[{"ElementType", ",", "integrationOrder"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"NMat", "=", 
       RowBox[{"ElementShapeFunction", "[", 
        RowBox[{"ElementType", ",", "elementOrder"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dN", "=", " ", 
       RowBox[{"ElementShapeFunctionDerivative", "[", 
        RowBox[{"ElementType", ",", "elementOrder"}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GuassIntegrate", "[", 
    RowBox[{"coord_List", ",", "f0_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"f", "=", "f0"}], ",", "GuassPointsSpatial"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"GuassPointsSpatial", "=", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"NMat", ",", "GuassPointsNatural", ",", "2"}], "]"}], ".", 
        "coord"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"GuassWeights", ".", 
       RowBox[{"MapThread", "[", 
        RowBox[{"f", ",", 
         RowBox[{"{", 
          RowBox[{"GuassPointsNatural", ",", "GuassPointsSpatial"}], "}"}]}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.79379931191206*^9, 3.7937993144137793`*^9}, {
   3.793818328542775*^9, 3.793818335572763*^9}, {3.7938194414296083`*^9, 
   3.7938194442223577`*^9}, {3.7938284288020697`*^9, 3.793828429144762*^9}, {
   3.79571999949585*^9, 3.795719999637581*^9}, {3.795730689985198*^9, 
   3.795730696356428*^9}, 3.795885228741413*^9, {3.795895519147976*^9, 
   3.795895520422917*^9}, 3.795904830280418*^9, 3.7959055912692127`*^9, {
   3.795905999435347*^9, 3.79590604499107*^9}, 3.7964741941357613`*^9, {
   3.7964742405645733`*^9, 3.796474240949234*^9}, {3.802468092360711*^9, 
   3.802468118174098*^9}, {3.8024714660205393`*^9, 3.802471520049564*^9}, 
   3.8024715751955137`*^9, 3.802472097119235*^9, {3.8024728784891243`*^9, 
   3.802472937563636*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"d68b8b31-45a4-4d5a-8485-f9010a05fb83"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ComputeResidualMatrixU", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ComputeResidualMatrixU", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComputeResidualMatrixU", "[", 
    RowBox[{
    "rMat_", ",", "e0_", ",", "UMat_", ",", "dt_", ",", "ElTypId_", ",", 
     "typeId_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"e", "=", "e0"}], "\[IndentingNewLine]", ",", "B", ",", "Q", 
       ",", "jacobi", ",", "BMat", ",", "ELEf", ",", "ELEr", ",", "ELEd", ",",
        "\[ScriptCapitalI]r", ",", "ELEu", ",", "coord", ",", "ELE\[Sigma]", 
       ",", "NBMat"}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"B", "=", 
       RowBox[{"IEN", "[", 
        RowBox[{"[", 
         RowBox[{"ElTypId", ",", ";;", ",", "e"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Q", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"IDMat", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "B"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coord", "=", 
       RowBox[{"Coords", "[", 
        RowBox[{"[", "B", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"jacobi", "=", 
       RowBox[{
        RowBox[{"Det", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], ")"}]}], 
        "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BMat", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], ".", 
          RowBox[{"dN", "@@", "#"}]}], ")"}], "&"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"ndof", " ", "\[Times]", " ", "nen"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ELEu", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"UMat", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "B"}], "]"}], "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"nen", " ", "\[Times]", " ", "ndof"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"NBMat", "=", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            RowBox[{"BMat", "[", "#", "]"}], "\[Transpose]"], ".", 
           RowBox[{"Inverse", "[", 
            RowBox[{"\[ScriptCapitalI]", "+", 
             RowBox[{
              RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}]}], "]"}]}], 
          "&"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ELEr", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"jacobi", "[", "#", "]"}], "*", 
           RowBox[{
            RowBox[{"Kirchhoff", "[", 
             RowBox[{"e", ",", "BMat", ",", "ELEu", ",", "#"}], "]"}], ".", 
            SuperscriptBox[
             RowBox[{"NBMat", "[", "#", "]"}], "\[Transpose]"]}]}], "&"}]}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"ELE\[Sigma]", "=", 
         RowBox[{
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{"Stiffness", ".", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "&"}]}], ";"}], 
       RowBox[{"(*", 
        RowBox[{"ndof", " ", "\[Times]", " ", "ndof"}], "*)"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ELE\[Sigma]", "=", 
       RowBox[{
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
            "typeId", ",", "1", ",", "StiffnessDev", ",", "2", ",", 
             "StiffnessVol"}], "]"}], ".", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "&"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"ndof", " ", "\[Times]", " ", "ndof"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ELEr", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"jacobi", "[", "#", "]"}], "*", 
         RowBox[{
          RowBox[{"ELE\[Sigma]", "[", "#", "]"}], ".", 
          RowBox[{"BMat", "[", "#", "]"}]}]}], "&"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"ndof", " ", "\[Times]", " ", "nen"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"ELEr", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"jacobi", "[", "#", "]"}], "*", 
           RowBox[{
            RowBox[{
             RowBox[{"stress", "[", 
              RowBox[{
              "e", ",", "dt", ",", "BMat", ",", "ELEu", ",", "ElTypId", ",", 
               "#"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{";;", "ndof"}], ",", 
               RowBox[{";;", "ndof"}]}], "]"}], "]"}], ".", 
            RowBox[{"BMat", "[", "#", "]"}]}]}], "&"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ELEd", "=", 
       RowBox[{"(*", 
        RowBox[{"ELEf", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "*)"}], 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"ELEr", "[", "#1", "]"}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalI]r", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"GuassIntegrate", "[", 
         RowBox[{"coord", ",", "ELEd"}], "]"}]}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"ndof", " ", "\[CirclePlus]", " ", "nen"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rMat", "[", 
        RowBox[{"[", "Q", "]"}], "]"}], "+=", "\[ScriptCapitalI]r"}], ";"}]}],
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "ComputeStiffnessMatrixU", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ComputeStiffnessMatrixU", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ComputeStiffnessMatrixU", "[", 
   RowBox[{
   "KMat_", ",", "e0_", ",", "UMat_", ",", "dt_", ",", "ElTypId_", ",", 
    "typeId_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"e", "=", "e0"}], "\[IndentingNewLine]", ",", "B", ",", "Q", 
      ",", "jacobi", ",", "BMat", ",", "ELEk", ",", "\[ScriptCapitalI]k", ",",
       "coord", ",", "ELEu", ",", "NBMat"}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"B", "=", 
      RowBox[{"IEN", "[", 
       RowBox[{"[", 
        RowBox[{"ElTypId", ",", ";;", ",", "e"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Q", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"IDMat", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "B"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"coord", "=", 
      RowBox[{"Coords", "[", 
       RowBox[{"[", "B", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"jacobi", "=", 
      RowBox[{
       RowBox[{"Det", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], ")"}]}], "&"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"BMat", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], ".", 
         RowBox[{"dN", "@@", "#"}]}], ")"}], "&"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"ndof", " ", "\[Times]", " ", "nen"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ELEu", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"UMat", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "B"}], "]"}], "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"nen", " ", "\[Times]", " ", "ndof"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"NBMat", "=", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"BMat", "[", "#", "]"}], "\[Transpose]"], ".", 
          RowBox[{"Inverse", "[", 
           RowBox[{"\[ScriptCapitalI]", "+", 
            RowBox[{
             RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}]}], "]"}]}], 
         "&"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"nen", " ", "\[Times]", " ", "ndof"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ELEk", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"jacobi", "[", "#", "]"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"TensorContract", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"NBMat", "[", "#", "]"}], "\[TensorProduct]", 
                  RowBox[{"Tangent", "[", 
                   RowBox[{"e", ",", "BMat", ",", "ELEu", ",", "#"}], "]"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"2", ",", "4"}], "}"}]}], "]"}], ".", 
               SuperscriptBox[
                RowBox[{"NBMat", "[", "#", "]"}], "\[Transpose]"]}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}]}], "]"}], 
            "-", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Kirchhoff", "[", 
                  RowBox[{"e", ",", "BMat", ",", "ELEu", ",", "#"}], "]"}], 
                 ".", 
                 SuperscriptBox[
                  RowBox[{"NBMat", "[", "#", "]"}], "\[Transpose]"]}], ")"}], 
               "\[TensorProduct]", 
               RowBox[{"NBMat", "[", "#", "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "3", ",", "1", ",", "4"}], "}"}]}], "]"}]}], 
           ")"}]}], "&"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "nen", " ", "\[Times]", " ", "ndof", " ", "\[Times]", " ", "nen", " ", 
       "\[Times]", " ", "ndof"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ELEk", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"jacobi", "[", "#", "]"}], 
          RowBox[{
           SuperscriptBox[
            RowBox[{"BMat", "[", "#", "]"}], "\[Transpose]"], ".", 
           RowBox[{"Tangent", "[", 
            RowBox[{
            "e", ",", "dt", ",", "BMat", ",", "ELEu", ",", "ElTypId", ",", 
             "#"}], "]"}], ".", 
           RowBox[{"BMat", "[", "#", "]"}]}]}], "&"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ELEk", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"jacobi", "[", "#", "]"}], 
        RowBox[{
         SuperscriptBox[
          RowBox[{"BMat", "[", "#", "]"}], "\[Transpose]"], ".", 
         RowBox[{"Switch", "[", 
          RowBox[{
          "typeId", ",", "1", ",", "StiffnessDev", ",", "2", ",", 
           "StiffnessVol"}], "]"}], ".", 
         RowBox[{"BMat", "[", "#", "]"}]}]}], "&"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "nen", " ", "\[Times]", " ", "ndof", " ", "\[Times]", " ", "ndof", " ", 
       "\[Times]", " ", "nen"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"\[ScriptCapitalI]k", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"GuassIntegrate", "[", 
           RowBox[{"coord", ",", "ELEk"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "3"}], "}"}]}], "}"}]}], "]"}]}], ";"}], 
      "*)"}], "  ", 
     RowBox[{"(*", 
      RowBox[{"ndof", " ", "\[CirclePlus]", " ", 
       RowBox[{"nen", " ", "\[Times]", " ", "ndof"}], " ", "\[CirclePlus]", 
       " ", "nen"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[ScriptCapitalI]k", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"GuassIntegrate", "[", 
         RowBox[{"coord", ",", "ELEk"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"ndof", " ", "\[CirclePlus]", " ", 
       RowBox[{"nen", " ", "\[Times]", " ", "ndof"}], " ", "\[CirclePlus]", 
       " ", "nen"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"KMat", "[", 
       RowBox[{"[", 
        RowBox[{"Q", ",", "Q"}], "]"}], "]"}], "+=", "\[ScriptCapitalI]k"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{{3.793312414930255*^9, 3.793312482731543*^9}, {
   3.793313326138242*^9, 3.793313327016553*^9}, {3.7938046911339083`*^9, 
   3.7938047305324287`*^9}, {3.793804841184092*^9, 3.793804841447917*^9}, {
   3.793804876953855*^9, 3.793804886746345*^9}, {3.79380505651079*^9, 
   3.793805107120332*^9}, {3.793805149689662*^9, 3.793805228477165*^9}, {
   3.7938067675597677`*^9, 3.793806794782155*^9}, {3.7938068559471607`*^9, 
   3.793806857771006*^9}, {3.793807139811202*^9, 3.793807155628137*^9}, {
   3.793807327593946*^9, 3.793807426506983*^9}, {3.793807509935306*^9, 
   3.793807552671719*^9}, {3.793807584993424*^9, 3.79380761231015*^9}, {
   3.793807703925989*^9, 3.7938077199091*^9}, {3.793810670303265*^9, 
   3.793810677236535*^9}, {3.7938108633954897`*^9, 3.793810889554409*^9}, 
   3.793810971376513*^9, {3.793811003919468*^9, 3.793811016680489*^9}, {
   3.793811054505879*^9, 3.793811138635181*^9}, {3.793811208535445*^9, 
   3.793811261326477*^9}, {3.7938113186829233`*^9, 3.7938113752739983`*^9}, {
   3.79381146762729*^9, 3.793811476508407*^9}, 3.7938115495924683`*^9, {
   3.793811834282887*^9, 3.7938118645061417`*^9}, {3.79381189612228*^9, 
   3.7938119101794033`*^9}, {3.793812121988791*^9, 3.793812126234168*^9}, {
   3.793812191635921*^9, 3.793812192595286*^9}, {3.7938123310079308`*^9, 
   3.7938124004512863`*^9}, {3.7938124755757427`*^9, 
   3.7938124917511797`*^9}, {3.7938127103610373`*^9, 
   3.7938127118120832`*^9}, {3.793812805497115*^9, 3.79381284572164*^9}, {
   3.793812981069058*^9, 3.793812999093711*^9}, 3.793813029631207*^9, 
   3.7938130609214983`*^9, {3.79381310904136*^9, 3.793813148356039*^9}, {
   3.793813315447496*^9, 3.793813318934965*^9}, {3.7938134577507467`*^9, 
   3.793813489198464*^9}, {3.793813527665221*^9, 3.7938135511522427`*^9}, {
   3.793813632066996*^9, 3.79381363313983*^9}, {3.793813752984619*^9, 
   3.793813825072781*^9}, {3.793813884962555*^9, 3.793813893281354*^9}, 
   3.7938139793575706`*^9, {3.793814068008057*^9, 3.793814089846696*^9}, {
   3.793814122793501*^9, 3.793814159914556*^9}, {3.793814334799244*^9, 
   3.793814390844679*^9}, {3.793814440972719*^9, 3.7938148314970503`*^9}, {
   3.79381489940394*^9, 3.793814955738553*^9}, {3.7938150828515043`*^9, 
   3.793815106593665*^9}, {3.793815138066759*^9, 3.7938151768929996`*^9}, {
   3.793815233091839*^9, 3.793815233717361*^9}, {3.793815380241811*^9, 
   3.793815410540317*^9}, {3.793815697611724*^9, 3.7938158048125153`*^9}, 
   3.7938159648236933`*^9, {3.7938162251668987`*^9, 3.7938162674277782`*^9}, 
   3.79381632548801*^9, {3.79381635889779*^9, 3.793816409164865*^9}, 
   3.793816471599225*^9, {3.793816781060658*^9, 3.793816785802322*^9}, {
   3.793817356880804*^9, 3.793817357117115*^9}, {3.793817706860291*^9, 
   3.793817732376149*^9}, {3.7938177811292477`*^9, 3.793817782191416*^9}, {
   3.793817878290914*^9, 3.7938179007852173`*^9}, {3.793818283602191*^9, 
   3.793818308857656*^9}, {3.793818342330567*^9, 3.7938184131371717`*^9}, 
   3.7938190576091223`*^9, {3.7938191214329863`*^9, 3.793819167761849*^9}, {
   3.793819285596223*^9, 3.7938193215400963`*^9}, {3.793819470450526*^9, 
   3.7938195006254597`*^9}, {3.793819531482374*^9, 3.793819535969645*^9}, {
   3.793819683047003*^9, 3.793819730286942*^9}, {3.7938198110194187`*^9, 
   3.793819820418338*^9}, {3.793823722094142*^9, 3.793823722397973*^9}, {
   3.793823970052415*^9, 3.793824068395213*^9}, {3.7938284072937593`*^9, 
   3.793828407465343*^9}, {3.793830695408679*^9, 3.793830707251841*^9}, {
   3.79387992016964*^9, 3.793879951443068*^9}, {3.7938800037955427`*^9, 
   3.79388009683038*^9}, {3.793916072085672*^9, 3.793916079226975*^9}, {
   3.794500906065949*^9, 3.794501040604981*^9}, {3.794501090853438*^9, 
   3.794501134303973*^9}, {3.794501680274601*^9, 3.794501686328144*^9}, 
   3.7945017573066072`*^9, {3.79450204834027*^9, 3.794502051108161*^9}, {
   3.79450321240757*^9, 3.794503220061603*^9}, {3.794503393791169*^9, 
   3.794503429989151*^9}, {3.7957308992699757`*^9, 3.795730902156196*^9}, {
   3.7957319660090923`*^9, 3.795731967513464*^9}, {3.795732622874792*^9, 
   3.79573263153761*^9}, {3.795732669007276*^9, 3.795732677086013*^9}, {
   3.795733162510436*^9, 3.795733164078148*^9}, {3.79578585215104*^9, 
   3.7957858550046883`*^9}, {3.795785928553431*^9, 3.7957859289435263`*^9}, {
   3.795786746391839*^9, 3.79578675004632*^9}, {3.795797841234269*^9, 
   3.795797849377082*^9}, {3.7957983392513523`*^9, 3.795798339553151*^9}, {
   3.7958032849048367`*^9, 3.795803368281461*^9}, {3.795803533738206*^9, 
   3.795803582352461*^9}, 3.7958036189709682`*^9, {3.795878593486264*^9, 
   3.7958787278818817`*^9}, {3.795879056595395*^9, 3.795879056909874*^9}, {
   3.795880672858368*^9, 3.7958806730269833`*^9}, {3.795883706449641*^9, 
   3.7958837079394007`*^9}, {3.795884054147273*^9, 3.795884110548414*^9}, {
   3.795884183917485*^9, 3.795884184254331*^9}, {3.795884227302202*^9, 
   3.795884228462473*^9}, 3.795884957159851*^9, {3.795888964929364*^9, 
   3.795888979725918*^9}, {3.795889240076689*^9, 3.795889246400079*^9}, {
   3.795889303351953*^9, 3.795889323371195*^9}, {3.795889430567219*^9, 
   3.795889463958746*^9}, 3.79588952233733*^9, {3.795891516092785*^9, 
   3.7958915169072447`*^9}, {3.7958920081164627`*^9, 3.795892071102961*^9}, {
   3.7958922844322367`*^9, 3.795892309752479*^9}, {3.795893561377695*^9, 
   3.7958935648048553`*^9}, {3.7958946512092524`*^9, 3.795894651368404*^9}, {
   3.795894779093772*^9, 3.79589478778747*^9}, {3.795900647422263*^9, 
   3.795900669916213*^9}, {3.7959048247502413`*^9, 3.7959048299577217`*^9}, 
   3.796330574498959*^9, {3.796403077433566*^9, 3.7964030778287907`*^9}, {
   3.796415065914618*^9, 3.7964150751699953`*^9}, {3.796415270830626*^9, 
   3.796415294982943*^9}, {3.796418411632616*^9, 3.796418413640218*^9}, {
   3.796418791016467*^9, 3.796418791901168*^9}, {3.796418929908414*^9, 
   3.796418942256049*^9}, {3.7964922243767014`*^9, 3.7964923930383*^9}, {
   3.796492533571537*^9, 3.7964925352593937`*^9}, {3.796492600062841*^9, 
   3.796492602774831*^9}, 3.796495040796733*^9, {3.802366311240451*^9, 
   3.802366340222869*^9}, 3.802366380743573*^9, {3.802367131257543*^9, 
   3.8023671461372957`*^9}, {3.80236729093215*^9, 3.8023673493520412`*^9}, {
   3.8023674912464533`*^9, 3.8023675733683777`*^9}, {3.802367649385242*^9, 
   3.802367712449932*^9}, {3.8023679034317713`*^9, 3.8023679464251747`*^9}, {
   3.8023683709853888`*^9, 3.802368433660742*^9}, {3.802369595004328*^9, 
   3.802369622260354*^9}, 3.802370025280703*^9, {3.802370083586038*^9, 
   3.80237009578541*^9}, 3.802370550237719*^9, {3.802371068947899*^9, 
   3.8023710795197163`*^9}, {3.802371698431617*^9, 3.802371702593875*^9}, {
   3.802372266132187*^9, 3.802372316085496*^9}, {3.80237241334978*^9, 
   3.8023724232198544`*^9}, {3.8023726904502563`*^9, 
   3.8023726959614267`*^9}, {3.8023728339104023`*^9, 
   3.8023728370932627`*^9}, {3.802374318757128*^9, 3.80237433189643*^9}, {
   3.802374426115423*^9, 3.802374428067905*^9}, {3.802374831137682*^9, 
   3.8023748314727793`*^9}, {3.802375235057152*^9, 3.8023752366467648`*^9}, {
   3.802375467312416*^9, 3.802375502504293*^9}, {3.802375535298959*^9, 
   3.802375535649652*^9}, {3.80237563575811*^9, 3.802375644932363*^9}, {
   3.802376036721261*^9, 3.802376036880156*^9}, {3.802439672849765*^9, 
   3.802439705132821*^9}, {3.802439833042194*^9, 3.8024398383671703`*^9}, {
   3.80243998949069*^9, 3.802440025411851*^9}, {3.802450102318226*^9, 
   3.802450181477003*^9}, {3.802450270054967*^9, 3.802450347863101*^9}, {
   3.802450382154233*^9, 3.8024504378687973`*^9}, {3.802467586512824*^9, 
   3.8024675972489443`*^9}, {3.802467653107547*^9, 3.802467733133102*^9}, {
   3.8024677715315638`*^9, 3.8024677895033693`*^9}, {3.802467899964325*^9, 
   3.802467900715914*^9}, {3.80246797841131*^9, 3.802467994493525*^9}, {
   3.802473113397051*^9, 3.802473150194785*^9}, {3.802473323584115*^9, 
   3.802473354065714*^9}, {3.8024734146053457`*^9, 3.802473420379985*^9}, {
   3.802473638174375*^9, 3.802473652411689*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"9907f5e7-58f0-41ac-b2cf-2df32d04c990"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CalrMat", "[", 
    RowBox[{"UMat_", ",", "dt_", ",", "ElTypId_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "GuassPointsNatural", ",", "GaussIndex", ",", "GuassWeights", ",", 
       "NMat", ",", "dN", ",", "rMatVol", ",", "rMatDev"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"rMatVol", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"ndof", "*", "nnp"}], "}"}], ",", "0.0"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelDo", "[", 
       RowBox[{
        RowBox[{"ComputeResidualMatrixU", "[", 
         RowBox[{
         "rMatVol", ",", "n", ",", "UMat", ",", "dt", ",", "ElTypId", ",", 
          "1"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rMatVol", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "rMatVol"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder", ",", 
        RowBox[{"ReducedIntegration", "->", "True"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"rMatDev", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"ndof", "*", "nnp"}], "}"}], ",", "0.0"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelDo", "[", 
       RowBox[{
        RowBox[{"ComputeResidualMatrixU", "[", 
         RowBox[{
         "rMatDev", ",", "n", ",", "UMat", ",", "dt", ",", "ElTypId", ",", 
          "2"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rMatDev", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "rMatDev"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rMatVol", "+", "rMatDev"}]}]}], "\[IndentingNewLine]", "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CalKMat", "[", 
    RowBox[{"UMat_", ",", "dt_", ",", "ElTypId_"}], "]"}], ":=", " ", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "GuassPointsNatural", ",", "GaussIndex", ",", "GuassWeights", ",", 
       "NMat", ",", "dN", ",", "KMatVol", ",", "KMatDev"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"KMatVol", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ndof", "*", "nnp"}], ",", 
            RowBox[{"ndof", "*", "nnp"}]}], "}"}], ",", "0.0"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelDo", "[", 
       RowBox[{
        RowBox[{"ComputeStiffnessMatrixU", "[", 
         RowBox[{
         "KMatVol", ",", "n", ",", "UMat", ",", "dt", ",", "ElTypId", ",", 
          "1"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"KMatVol", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "KMatVol"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder", ",", 
        RowBox[{"ReducedIntegration", "->", "True"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"KMatDev", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ndof", "*", "nnp"}], ",", 
            RowBox[{"ndof", "*", "nnp"}]}], "}"}], ",", "0.0"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelDo", "[", 
       RowBox[{
        RowBox[{"ComputeStiffnessMatrixU", "[", 
         RowBox[{
         "KMatDev", ",", "n", ",", "UMat", ",", "dt", ",", "ElTypId", ",", 
          "2"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"KMatDev", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "KMatDev"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"KMatVol", "+", "KMatDev"}]}]}], "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParallelResidual", "[", 
    RowBox[{"UMat_", ",", "dt_", ",", "TracInd_", ",", "ConcenInd_"}], "]"}], 
   ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rMat", ",", "Err", ",", "tMat"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rMat", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"CalrMat", "[", 
            RowBox[{"UMat", ",", "dt", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "@", "nElTyp"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"TracInd", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ParallelEvaluate", "[", 
          RowBox[{"tMat", "=", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ndof", "*", "nnp"}], "}"}], ",", "0.0"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ParallelDo", "[", 
          RowBox[{
           RowBox[{"ApplyTraction", "[", 
            RowBox[{"tMat", ",", "edge"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"edge", ",", "Edges"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tMat", "=", 
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{"ParallelEvaluate", "@", "tMat"}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"rMat", "+=", "tMat"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"ConcenInd", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"rMat", "[", 
           RowBox[{"[", "NeumannDof", "]"}], "]"}], "+=", "NeumannVals"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Err", " ", "=", 
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"rMat", "[", 
          RowBox[{"[", "IDno", "]"}], "]"}], ",", "Infinity"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"Err", ",", "rMat"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParallelStiffness", "[", 
   RowBox[{"UMat_", ",", "dt_"}], "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "KMat", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"KMat", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"CalKMat", "[", 
           RowBox[{"UMat", ",", "dt", ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "@", "nElTyp"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "KMat"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{{3.793312414930255*^9, 3.793312482731543*^9}, {
   3.793313326138242*^9, 3.793313327016553*^9}, {3.7938046911339083`*^9, 
   3.7938047305324287`*^9}, {3.793804841184092*^9, 3.793804841447917*^9}, {
   3.793804876953855*^9, 3.793804886746345*^9}, {3.79380505651079*^9, 
   3.793805107120332*^9}, {3.793805149689662*^9, 3.793805228477165*^9}, {
   3.7938067675597677`*^9, 3.793806794782155*^9}, {3.7938068559471607`*^9, 
   3.793806857771006*^9}, {3.793807139811202*^9, 3.793807155628137*^9}, {
   3.793807327593946*^9, 3.793807426506983*^9}, {3.793807509935306*^9, 
   3.793807552671719*^9}, {3.793807584993424*^9, 3.79380761231015*^9}, {
   3.793807703925989*^9, 3.7938077199091*^9}, {3.793810670303265*^9, 
   3.793810677236535*^9}, {3.7938108633954897`*^9, 3.793810889554409*^9}, 
   3.793810971376513*^9, {3.793811003919468*^9, 3.793811016680489*^9}, {
   3.793811054505879*^9, 3.793811138635181*^9}, {3.793811208535445*^9, 
   3.793811261326477*^9}, {3.7938113186829233`*^9, 3.7938113752739983`*^9}, {
   3.79381146762729*^9, 3.793811476508407*^9}, 3.7938115495924683`*^9, {
   3.793811834282887*^9, 3.7938118645061417`*^9}, {3.79381189612228*^9, 
   3.7938119101794033`*^9}, {3.793812121988791*^9, 3.793812126234168*^9}, {
   3.793812191635921*^9, 3.793812192595286*^9}, {3.7938123310079308`*^9, 
   3.7938124004512863`*^9}, {3.7938124755757427`*^9, 
   3.7938124917511797`*^9}, {3.7938127103610373`*^9, 
   3.7938127118120832`*^9}, {3.793812805497115*^9, 3.79381284572164*^9}, {
   3.793812981069058*^9, 3.793812999093711*^9}, 3.793813029631207*^9, 
   3.7938130609214983`*^9, {3.79381310904136*^9, 3.793813148356039*^9}, {
   3.793813315447496*^9, 3.793813318934965*^9}, {3.7938134577507467`*^9, 
   3.793813489198464*^9}, {3.793813527665221*^9, 3.7938135511522427`*^9}, {
   3.793813632066996*^9, 3.79381363313983*^9}, {3.793813752984619*^9, 
   3.793813825072781*^9}, {3.793813884962555*^9, 3.793813893281354*^9}, 
   3.7938139793575706`*^9, {3.793814068008057*^9, 3.793814089846696*^9}, {
   3.793814122793501*^9, 3.793814159914556*^9}, {3.793814334799244*^9, 
   3.793814390844679*^9}, {3.793814440972719*^9, 3.7938148314970503`*^9}, {
   3.79381489940394*^9, 3.793814955738553*^9}, {3.7938150828515043`*^9, 
   3.793815106593665*^9}, {3.793815138066759*^9, 3.7938151768929996`*^9}, {
   3.793815233091839*^9, 3.793815233717361*^9}, {3.793815380241811*^9, 
   3.793815410540317*^9}, {3.793815697611724*^9, 3.7938158048125153`*^9}, 
   3.7938159648236933`*^9, {3.7938162251668987`*^9, 3.7938162674277782`*^9}, 
   3.79381632548801*^9, {3.79381635889779*^9, 3.793816409164865*^9}, 
   3.793816471599225*^9, {3.793816781060658*^9, 3.793816785802322*^9}, {
   3.793817356880804*^9, 3.793817357117115*^9}, {3.793817706860291*^9, 
   3.793817732376149*^9}, {3.7938177811292477`*^9, 3.793817782191416*^9}, {
   3.793817878290914*^9, 3.7938179007852173`*^9}, {3.793818283602191*^9, 
   3.793818308857656*^9}, {3.793818342330567*^9, 3.7938184131371717`*^9}, 
   3.7938190576091223`*^9, {3.7938191214329863`*^9, 3.793819167761849*^9}, {
   3.793819285596223*^9, 3.7938193215400963`*^9}, {3.793819470450526*^9, 
   3.7938195006254597`*^9}, {3.793819531482374*^9, 3.793819535969645*^9}, {
   3.793819683047003*^9, 3.793819730286942*^9}, {3.7938198110194187`*^9, 
   3.793819820418338*^9}, {3.793823722094142*^9, 3.793823722397973*^9}, {
   3.793823970052415*^9, 3.793824068395213*^9}, {3.7938284072937593`*^9, 
   3.793828407465343*^9}, {3.793830695408679*^9, 3.793830707251841*^9}, {
   3.79387992016964*^9, 3.793879951443068*^9}, {3.7938800037955427`*^9, 
   3.79388009683038*^9}, {3.793916072085672*^9, 3.793916079226975*^9}, {
   3.794500906065949*^9, 3.794501040604981*^9}, {3.794501090853438*^9, 
   3.794501134303973*^9}, {3.794501680274601*^9, 3.794501686328144*^9}, 
   3.7945017573066072`*^9, {3.79450204834027*^9, 3.794502051108161*^9}, {
   3.79450321240757*^9, 3.794503220061603*^9}, {3.794503393791169*^9, 
   3.794503429989151*^9}, {3.7957308992699757`*^9, 3.795730902156196*^9}, {
   3.7957319660090923`*^9, 3.795731967513464*^9}, {3.795732622874792*^9, 
   3.79573263153761*^9}, {3.795732669007276*^9, 3.795732677086013*^9}, {
   3.795733162510436*^9, 3.795733164078148*^9}, {3.79578585215104*^9, 
   3.7957858550046883`*^9}, {3.795785928553431*^9, 3.7957859289435263`*^9}, {
   3.795786746391839*^9, 3.79578675004632*^9}, {3.795797841234269*^9, 
   3.795797849377082*^9}, {3.7957983392513523`*^9, 3.795798339553151*^9}, {
   3.7958032849048367`*^9, 3.795803368281461*^9}, {3.795803533738206*^9, 
   3.795803582352461*^9}, 3.7958036189709682`*^9, {3.795878593486264*^9, 
   3.7958787278818817`*^9}, {3.795879056595395*^9, 3.795879056909874*^9}, {
   3.795880672858368*^9, 3.7958806730269833`*^9}, {3.795883706449641*^9, 
   3.7958837079394007`*^9}, {3.795884054147273*^9, 3.795884110548414*^9}, {
   3.795884183917485*^9, 3.795884184254331*^9}, {3.795884227302202*^9, 
   3.795884228462473*^9}, 3.795884957159851*^9, {3.795885044670084*^9, 
   3.7958850465015497`*^9}, {3.795887325700604*^9, 3.795887336768312*^9}, {
   3.795888948198344*^9, 3.7958889507483397`*^9}, {3.7958889859746733`*^9, 
   3.795888997517632*^9}, {3.795889253750669*^9, 3.7958892711438513`*^9}, {
   3.7958893266346684`*^9, 3.79588934870621*^9}, {3.7958895320257187`*^9, 
   3.7958895493267317`*^9}, {3.795890791063676*^9, 3.795890791989972*^9}, {
   3.795890825368848*^9, 3.795890825727715*^9}, {3.795890899362989*^9, 
   3.795890928387755*^9}, {3.7958915385006247`*^9, 3.795891555975667*^9}, {
   3.795891888520817*^9, 3.795891994602365*^9}, {3.795892078619269*^9, 
   3.7958920809725513`*^9}, {3.795892394198845*^9, 3.7958923952379208`*^9}, {
   3.795892433414774*^9, 3.795892462751419*^9}, {3.7958924944794493`*^9, 
   3.795892587405079*^9}, {3.795892626225244*^9, 3.795892631990765*^9}, {
   3.7958927209142523`*^9, 3.7958928071697893`*^9}, {3.795892895018756*^9, 
   3.795892927866674*^9}, {3.7958929594931517`*^9, 3.7958929876859093`*^9}, 
   3.795893176055046*^9, 3.7958945269618196`*^9, 3.795894665231642*^9, {
   3.795894767476336*^9, 3.7958947708443003`*^9}, {3.7959006496347733`*^9, 
   3.7959006504878674`*^9}, {3.7959006913800783`*^9, 3.795900692091031*^9}, {
   3.795900786109909*^9, 3.795900791958282*^9}, {3.7959048286963673`*^9, 
   3.795904830711022*^9}, 3.795906082233069*^9, {3.7960667566858377`*^9, 
   3.796066818432391*^9}, {3.796066896854307*^9, 3.796067015584268*^9}, {
   3.796067163266684*^9, 3.796067204869421*^9}, {3.796067647252634*^9, 
   3.796067658156438*^9}, {3.796067705550016*^9, 3.796067708252043*^9}, {
   3.796067809812846*^9, 3.79606781365341*^9}, {3.796067905699445*^9, 
   3.79606795277386*^9}, {3.7960679955368967`*^9, 3.796068070626453*^9}, 
   3.796068153464738*^9, {3.7963308579658613`*^9, 3.796330937264369*^9}, {
   3.79641422531218*^9, 3.796414225637849*^9}, {3.796414964830347*^9, 
   3.796414968344345*^9}, {3.796415005185834*^9, 3.7964150563996572`*^9}, {
   3.796415135083581*^9, 3.796415238150584*^9}, {3.796415335298867*^9, 
   3.7964155790886297`*^9}, {3.79641562333996*^9, 3.79641578234489*^9}, {
   3.796416515831464*^9, 3.796416567936668*^9}, {3.796416614545985*^9, 
   3.796416616450452*^9}, {3.79641664854954*^9, 3.796416832080278*^9}, {
   3.7964170261365356`*^9, 3.796417038914188*^9}, 3.796417320584948*^9, {
   3.796417380210493*^9, 3.796417727396778*^9}, {3.796417795551292*^9, 
   3.796417852182886*^9}, {3.796418200820908*^9, 3.796418234045433*^9}, {
   3.7964183660898457`*^9, 3.796418368548085*^9}, {3.796418445734087*^9, 
   3.796418446370977*^9}, {3.7964190643813334`*^9, 3.7964190731081123`*^9}, {
   3.796419234041265*^9, 3.796419270648429*^9}, {3.796419356220385*^9, 
   3.79641941351446*^9}, {3.796419490031887*^9, 3.796419511591383*^9}, {
   3.796473704495125*^9, 3.796473706334363*^9}, {3.796473744103134*^9, 
   3.796473773169223*^9}, {3.796474031617371*^9, 3.796474061097624*^9}, {
   3.796474094564712*^9, 3.796474108659706*^9}, 3.796474428370273*^9, {
   3.796474561681253*^9, 3.796474571299049*^9}, {3.796474819561933*^9, 
   3.796474826972148*^9}, {3.7964931250530243`*^9, 3.7964931411624126`*^9}, {
   3.796496976287669*^9, 3.796496980678784*^9}, {3.8023703092585497`*^9, 
   3.802370309736621*^9}, {3.802370760883237*^9, 3.802370768265436*^9}, {
   3.802472116082801*^9, 3.802472124720255*^9}, {3.802472766383211*^9, 
   3.802472836859437*^9}, {3.802472979725607*^9, 3.8024729834453793`*^9}, {
   3.80247309156168*^9, 3.802473105096909*^9}, {3.802473158090968*^9, 
   3.802473184963606*^9}, {3.802473665525226*^9, 3.802473743589694*^9}, {
   3.8024738946198*^9, 3.802473894977971*^9}, {3.8189407104523687`*^9, 
   3.8189407858293447`*^9}, {3.818940816412943*^9, 3.8189408360068274`*^9}, {
   3.818942012710651*^9, 3.8189420131609373`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"ef661214-6651-46b2-883d-cd6f9da4f8c5"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Post-processing subroutine", "Subsection",
 CellChangeTimes->{{3.802370919211224*^9, 
  3.802370926076188*^9}},ExpressionUUID->"b68a3e68-51b1-40a3-928c-\
18feccf2aee8"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ComputeStressProjection", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ComputeStressProjection", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComputeStressProjection", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aMat_", ",", "UdMat_"}], "}"}], ",", "e0_", ",", "UMat_", ",", 
     
     RowBox[{"(*", 
      RowBox[{"\[Sigma]_", ","}], "*)"}], "ElTypId_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"e", "=", "e0"}], ",", "B", ",", "jacobi", ",", "BMat", ",", 
       "\[ScriptCapitalI]k", ",", "\[ScriptCapitalI]f", ",", "ff", ",", "fk", 
       ",", "coord", ",", "ELEu", ",", "ELE\[Sigma]"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"B", "=", 
       RowBox[{"IEN", "[", 
        RowBox[{"[", 
         RowBox[{"ElTypId", ",", ";;", ",", "e"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coord", "=", 
       RowBox[{"Coords", "[", 
        RowBox[{"[", "B", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"jacobi", "=", 
       RowBox[{
        RowBox[{"Det", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], ")"}]}], 
        "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BMat", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], ".", 
          RowBox[{"dN", "@@", "#"}]}], ")"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ELEu", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"UMat", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "B"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fk", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"jacobi", "[", "#", "]"}], 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NMat", "@@", "#"}], ")"}], "\[TensorProduct]", 
          RowBox[{"(", 
           RowBox[{"NMat", "@@", "#"}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalI]k", "=", 
       RowBox[{"GuassIntegrate", "[", 
        RowBox[{"coord", ",", "fk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"aMat", "[", 
        RowBox[{"[", 
         RowBox[{"B", ",", "B"}], "]"}], "]"}], "+=", "\[ScriptCapitalI]k"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ELE\[Sigma]", "=", 
       RowBox[{
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{"Stiffness", ".", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ff", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"jacobi", "[", "#", "]"}], 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NMat", "@@", "#"}], ")"}], "\[TensorProduct]", 
          RowBox[{"Flatten", "[", 
           RowBox[{"ELE\[Sigma]", "[", "#", "]"}], "]"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"ff", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"jacobi", "[", "#", "]"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"NMat", "@@", "#"}], ")"}], "\[TensorProduct]", 
            RowBox[{"Flatten", "[", 
             RowBox[{"\[Sigma]", "[", 
              RowBox[{"[", 
               RowBox[{"e", ",", 
                RowBox[{"GaussIndex", "@", "#"}]}], "]"}], "]"}], "]"}]}]}], 
          "&"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalI]f", "=", 
       RowBox[{"GuassIntegrate", "[", 
        RowBox[{"coord", ",", "ff"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"UdMat", "[", 
        RowBox[{"[", 
         RowBox[{"B", ",", ";;"}], "]"}], "]"}], "+=", "\[ScriptCapitalI]f"}],
       ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CalAUdMat", "[", 
    RowBox[{"UMat_", ",", 
     RowBox[{"(*", 
      RowBox[{"\[Sigma]_", ","}], "*)"}], "ElTypId_"}], "]"}], ":=", " ", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "GuassPointsNatural", ",", "GaussIndex", ",", "GuassWeights", ",", 
       "NMat", ",", "dN", ",", "aMat", ",", "UdMat"}], "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"aMat", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"nnp", ",", "nnp"}], "}"}], ",", "0.0"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ParallelEvaluate", "[", 
       RowBox[{"UdMat", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", 
           RowBox[{"nnp", ",", "nud"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ParallelDo", "[", 
       RowBox[{
        RowBox[{"ComputeStressProjection", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"aMat", ",", "UdMat"}], "}"}], ",", "n", ",", "UMat", ",", 
          
          RowBox[{"(*", 
           RowBox[{"\[Sigma]", ","}], "*)"}], "ElTypId"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"aMat", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "aMat"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UdMat", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "UdMat"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"aMat", ",", "UdMat"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"StressRecover", "[", "UMat_", 
   RowBox[{"(*", 
    RowBox[{",", "\[Sigma]_"}], "*)"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nud", "=", " ", 
       RowBox[{"ndof", "*", "ndof"}]}], ",", "AUdMat", ",", "aMat", ",", 
      "UdMat", ",", "SolUd", ",", "SolUdMat", ",", "StressMat", ",", 
      "StressMatf"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"AUdMat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"CalAUdMat", "[", 
         RowBox[{"UMat", 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"\[Sigma]", "[", 
             RowBox[{"[", "#", "]"}], "]"}]}], "*)"}], ",", "#"}], "]"}], 
        "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Range", "@", "nElTyp"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"aMat", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"AUdMat", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"UdMat", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"AUdMat", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SolUd", "=", 
      RowBox[{"LinearSolve", "[", 
       RowBox[{"aMat", ",", "UdMat"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"StressMat", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"SolUd", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "@", "SolUd"}], ",", "ndof", ",", "ndof"}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"StressMatf", "=", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ElementMeshInterpolation", "[", 
           RowBox[{
            RowBox[{"{", "mesh", "}"}], ",", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"StressMat", ",", 
               RowBox[{"{", 
                RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"#", ",", ";;"}], "]"}], "]"}]}], "]"}], " ", "&"}], 
         " ", "/@", " ", 
         RowBox[{"Range", "[", "nud", "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ndof", ",", "ndof"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "StressMatf"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{
  3.793811551344652*^9, 3.793993457285849*^9, 3.793995805727461*^9, {
   3.7940026296782827`*^9, 3.7940026620271187`*^9}, {3.794002692608522*^9, 
   3.794002722334773*^9}, 3.7940027830399313`*^9, {3.795806635449129*^9, 
   3.7958066496132*^9}, {3.795879223292399*^9, 3.795879223547884*^9}, {
   3.7958792629030333`*^9, 3.795879281868167*^9}, 3.795880676455729*^9, {
   3.7958807361823597`*^9, 3.795880737094323*^9}, 3.79588371189216*^9, {
   3.795884914515164*^9, 3.795884914804512*^9}, {3.79588964398378*^9, 
   3.7958896500189657`*^9}, {3.795901213708665*^9, 3.795901244569368*^9}, {
   3.795901600048128*^9, 3.7959016015414867`*^9}, {3.795901892316765*^9, 
   3.7959019083603697`*^9}, {3.7959048251229067`*^9, 
   3.7959048280077333`*^9}, {3.796403205099222*^9, 3.796403205714004*^9}, {
   3.7964190069851017`*^9, 3.7964190270868998`*^9}, {3.796474972958446*^9, 
   3.796474989221637*^9}, {3.796478188821973*^9, 3.796478214655401*^9}, {
   3.7964782609051313`*^9, 3.796478385853236*^9}, {3.796478442838108*^9, 
   3.796478448415464*^9}, {3.7964785019508553`*^9, 3.7964785875696173`*^9}, {
   3.796479576184697*^9, 3.7964795936488247`*^9}, {3.796492487100058*^9, 
   3.796492514923314*^9}, {3.796492584328537*^9, 3.796492588022887*^9}, {
   3.7964927320560017`*^9, 3.796492767449391*^9}, {3.796493100268127*^9, 
   3.796493114033552*^9}, {3.796495356884*^9, 3.7964953779795523`*^9}, {
   3.796495472999744*^9, 3.796495579521288*^9}, 3.802472139433408*^9},
 CellLabel->"In[37]:=",ExpressionUUID->"c90ca03f-4b88-471f-a9c5-98a6503d47f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Only", " ", "applicable", " ", "in", " ", "Linear", " ", "Elastic"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"ComputeRF", "[", 
      RowBox[{"UMat_", ",", "dt_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "KMat", ",", "udsol", ",", "udMat", ",", "RFTotalVec", ",", "RFPos"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"KMat", "=", 
         RowBox[{"ParallelStiffness", "[", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"RFTotalVec", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              SuperscriptBox["UMat", "\[Transpose]"], "]"}], "[", 
             RowBox[{"[", "IDno", "]"}], "]"}], ".", 
            RowBox[{"KMat", "[", 
             RowBox[{"[", 
              RowBox[{"IDno", ",", "DirichletDof"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              SuperscriptBox["UMat", "\[Transpose]"], "]"}], "[", 
             RowBox[{"[", "DirichletDof", "]"}], "]"}], ".", 
            RowBox[{"KMat", "[", 
             RowBox[{"[", 
              RowBox[{"DirichletDof", ",", "DirichletDof"}], "]"}], "]"}]}]}],
           ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"RFPos", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"DirichletDof", ",", "#"}], "]"}], "&"}], "/@", 
           "NeumannDof"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Total", "@", 
         RowBox[{"RFTotalVec", "[", 
          RowBox[{"[", "RFPos", "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "CalEE", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CalEE", "[", 
     RowBox[{"UMat_", ",", 
      RowBox[{"(*", 
       RowBox[{"\[Sigma]_", ","}], "*)"}], "ElTypId_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "GuassPointsNatural", ",", "GaussIndex", ",", "GuassWeights", ",", 
        "NMat", ",", "dN", ",", "Eg"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DefineGaussAndSFInfo", "[", 
        RowBox[{
         RowBox[{"ElementType", "[", 
          RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{"Eg", "=", "0"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ParallelDo", "[", 
        RowBox[{
         RowBox[{"ComputeEE", "[", 
          RowBox[{"Eg", ",", "n", ",", "UMat", ",", 
           RowBox[{"(*", 
            RowBox[{"\[Sigma]", ","}], "*)"}], "ElTypId"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", 
           RowBox[{"nel", "[", 
            RowBox[{"[", "ElTypId", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{"ParallelEvaluate", "@", "Eg"}], ")"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "ComputeEE", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"ComputeEE", ",", "HoldFirst"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ComputeEE", "[", 
     RowBox[{"Eg_", ",", "e0_", ",", "UMat_", ",", 
      RowBox[{"(*", 
       RowBox[{"\[Sigma]_", ","}], "*)"}], "ElTypId_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"e", "=", "e0"}], ",", "B", ",", "coord", ",", "jacobi", ",", 
        "BMat", ",", "ELEu", ",", "ELE\[Sigma]", ",", "ELEEg"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", "=", 
        RowBox[{"IEN", "[", 
         RowBox[{"[", 
          RowBox[{"ElTypId", ",", ";;", ",", "e"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"coord", "=", 
        RowBox[{"Coords", "[", 
         RowBox[{"[", "B", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"jacobi", "=", 
        RowBox[{
         RowBox[{"Det", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], ")"}]}], 
         "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"BMat", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], ".", 
           RowBox[{"dN", "@@", "#"}]}], ")"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ELEu", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"UMat", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "B"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ELE\[Sigma]", "=", 
        RowBox[{
         RowBox[{"TensorContract", "[", 
          RowBox[{
           RowBox[{"Stiffness", ".", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"ELE\[Sigma]", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Sigma]", "[", 
             RowBox[{"[", 
              RowBox[{"e", ",", 
               RowBox[{"GaussIndex", "@", "#"}]}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{";;", "ndof"}], ",", 
              RowBox[{";;", "ndof"}]}], "]"}], "]"}], "&"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ELEEg", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"jacobi", "[", "#", "]"}], "*", 
          RowBox[{"Tr", "[", 
           RowBox[{
            RowBox[{"ELE\[Sigma]", "[", "#", "]"}], ".", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"BMat", "[", "#", "]"}], ".", "ELEu"}], ")"}]}], 
           "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Eg", "+=", 
        RowBox[{"GuassIntegrate", "[", 
         RowBox[{"coord", ",", "ELEEg"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{
  3.793811551344652*^9, 3.793993457285849*^9, 3.793995805727461*^9, {
   3.7940026296782827`*^9, 3.7940026620271187`*^9}, {3.794002692608522*^9, 
   3.794002722334773*^9}, 3.7940027830399313`*^9, {3.795806635449129*^9, 
   3.7958066496132*^9}, {3.795879223292399*^9, 3.795879223547884*^9}, {
   3.7958792629030333`*^9, 3.795879281868167*^9}, 3.795880676455729*^9, {
   3.7958807361823597`*^9, 3.795880737094323*^9}, 3.79588371189216*^9, {
   3.795884914515164*^9, 3.795884914804512*^9}, {3.79588964398378*^9, 
   3.7958896500189657`*^9}, {3.795901213708665*^9, 3.795901244569368*^9}, {
   3.7959061640457897`*^9, 3.7959061650344067`*^9}, {3.7960580156072493`*^9, 
   3.796058016810659*^9}, {3.7960652734962683`*^9, 3.796065294540007*^9}, {
   3.796403004625722*^9, 3.7964030307800922`*^9}, {3.796403083381716*^9, 
   3.796403084150477*^9}, {3.7964031882813272`*^9, 3.796403236850711*^9}, {
   3.796404412654241*^9, 3.796404659640275*^9}, {3.7964047102283916`*^9, 
   3.7964047107708197`*^9}, {3.796409866724308*^9, 3.796409871220175*^9}, 
   3.7964101563894863`*^9, {3.7964786777978477`*^9, 3.796478678124386*^9}, {
   3.796478806998704*^9, 3.79647887381256*^9}, {3.796479167052311*^9, 
   3.796479213292479*^9}, {3.796479638532662*^9, 3.79647973560458*^9}, 
   3.796479852914029*^9, {3.7964925535482273`*^9, 3.796492575472651*^9}, {
   3.796492792937558*^9, 3.7964928038102922`*^9}, {3.7964929808315487`*^9, 
   3.7964929861874228`*^9}, {3.7964930904575577`*^9, 3.796493094897382*^9}, 
   3.796495130299199*^9, 3.8024721478184757`*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"17788649-0f79-4cfe-9df3-239aa542d934"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load steps & Abaqus mesh ", "Subsection",
 CellChangeTimes->{{3.802370944324473*^9, 
  3.802370971852425*^9}},ExpressionUUID->"863735f3-6534-4c41-a20f-\
9d33e1f41e8e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DefineLoadStep", "[", 
    RowBox[{"LoadStt_", ",", "LoadEnd_", ",", "nsteps_", ",", "TimePeriod_"}],
     "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", "\[InvisibleSpace]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dt", ",", "StepSize", ",", "LoadStep", ",", "LoadInc"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dt", " ", "=", " ", 
       RowBox[{"TimePeriod", "/", "nsteps"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"StepSize", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"LoadEnd", "-", "LoadStt"}], ")"}], "/", "nsteps"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"LoadStep", "=", 
       RowBox[{
        RowBox[{"Subdivide", "[", 
         RowBox[{"LoadStt", ",", "LoadEnd", ",", "nsteps"}], "]"}], "/", 
        "LoadEnd"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LoadInc", " ", "=", " ", 
       RowBox[{"LoadStep", "-", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"LoadStep", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], ",", "0.0"}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dt", ",", 
         RowBox[{"LoadStep", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
         RowBox[{"LoadInc", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], "//", "N"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Inp2Mesh", "[", "inp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "MeshString", ",", "NodeSttId", ",", "ElementTriSttId", ",", 
      "ElementQuadSttId", ",", "ElementQuadEndId", ",", "NodeCoord", ",", 
      "ElementTri", ",", "ElementQuad"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MeshString", " ", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"inp", ",", "\"\<Data\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NodeSttId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", "\"\<*Node\>\"", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ElementTriSttId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<*Element\>\"", ",", "\"\<type=CPE3\>\""}], "}"}]}], 
        "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ElementQuadSttId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<*Element\>\"", ",", "\"\<type=CPE4R\>\""}], "}"}]}], 
        "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ElementQuadEndId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", "\"\<nset=Set-1\>\""}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NodeCoord", "=", 
      RowBox[{"MeshString", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"NodeSttId", "+", "1"}], ";;", 
         RowBox[{"ElementTriSttId", "-", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ElementTri", "=", 
      RowBox[{"MeshString", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"ElementTriSttId", "+", "1"}], ";;", 
         RowBox[{"ElementQuadSttId", "-", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ElementQuad", "=", 
      RowBox[{"MeshString", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"ElementQuadSttId", "+", "1"}], ";;", 
         RowBox[{"ElementQuadEndId", "-", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ToElementMesh", "[", 
      RowBox[{
       RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
        RowBox[{"NodeCoord", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", 
           RowBox[{"2", ";;"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"TriangleElement", "[", 
           RowBox[{"ElementTri", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{"2", ";;"}]}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"QuadElement", "[", 
           RowBox[{"ElementQuad", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{"2", ";;"}]}], "]"}], "]"}], "]"}]}], "}"}]}], ",", 
       RowBox[{"\"\<MeshOrder\>\"", "\[Rule]", "1"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Inp2Mesh3D", "[", "inp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "MeshString", ",", "NodeSttId", ",", "ElementTriSttId", ",", 
      "ElementQuadSttId", ",", "ElementQuadEndId", ",", "NodeCoord", ",", 
      "ElementTri", ",", "ElementQuad"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MeshString", " ", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"inp", ",", "\"\<CSV\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NodeSttId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", "\"\<*Node\>\"", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ElementTriSttId", "=", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"MeshString", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<*Element\>\"", ",", "\"\<type=C3D8R\>\""}], "}"}]}], 
          "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ElementQuadSttId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<*Element\>\"", ",", "\"\<type=C3D8R\>\""}], "}"}]}], 
        "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ElementQuadEndId", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"MeshString", ",", 
         RowBox[{"{", 
          RowBox[{
          "\"\<*Nset\>\"", ",", "\"\<nset=Body\>\"", ",", 
           "\"\<generate\>\""}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NodeCoord", "=", 
      RowBox[{"MeshString", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"NodeSttId", "+", "1"}], ";;", 
         RowBox[{"ElementQuadSttId", "-", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ElementTri", "=", 
        RowBox[{"MeshString", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"ElementTriSttId", "+", "1"}], ";;", 
           RowBox[{"ElementQuadSttId", "-", "1"}]}], "]"}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ElementQuad", "=", 
      RowBox[{"MeshString", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"ElementQuadSttId", "+", "1"}], ";;", 
         RowBox[{"ElementQuadEndId", "-", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ToElementMesh", "[", 
      RowBox[{
       RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
        RowBox[{"NodeCoord", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", 
           RowBox[{"2", ";;"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"HexahedronElement", "[", 
          RowBox[{"ElementQuad", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", 
             RowBox[{"2", ";;"}]}], "]"}], "]"}], "]"}], "}"}]}], ",", 
       RowBox[{"\"\<MeshOrder\>\"", "\[Rule]", "1"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{
  3.793804658781251*^9, {3.793811552790379*^9, 3.793811553659974*^9}, {
   3.7938285034613457`*^9, 3.793828579101207*^9}, {3.793828783328065*^9, 
   3.793828809392131*^9}, {3.7938802307629833`*^9, 3.793880258139724*^9}, {
   3.793969598250634*^9, 3.7939695984024076`*^9}, {3.794501193609117*^9, 
   3.794501270019347*^9}, {3.7957308003642187`*^9, 3.795730817329308*^9}, {
   3.795731975115056*^9, 3.79573198750695*^9}, {3.795732091810445*^9, 
   3.7957320949720097`*^9}, 3.795732513073844*^9, {3.795732549826754*^9, 
   3.795732559314783*^9}, {3.795732863909663*^9, 3.795732898214961*^9}, {
   3.7957859051213512`*^9, 3.7957859076458673`*^9}, 3.795803655909457*^9, {
   3.7958065021685963`*^9, 3.795806502302767*^9}, {3.795883579233322*^9, 
   3.7958836397742367`*^9}, {3.795884899698188*^9, 3.795884899924852*^9}, {
   3.795885229270583*^9, 3.7958852296461353`*^9}, {3.795888096257517*^9, 
   3.795888111872776*^9}, 3.795889630828102*^9, {3.795892351950136*^9, 
   3.79589235473213*^9}, 3.7958947212328997`*^9, {3.795904828087297*^9, 
   3.795904830795863*^9}, {3.795905245202338*^9, 3.7959052452484827`*^9}, {
   3.795905592647915*^9, 3.795905593377412*^9}, {3.7959577459763203`*^9, 
   3.795957779291843*^9}, 3.7960653022538223`*^9, {3.7964110788494873`*^9, 
   3.796411079569504*^9}, {3.796414550193788*^9, 3.796414558874577*^9}, {
   3.796414596497768*^9, 3.796414618738894*^9}, {3.796414651996418*^9, 
   3.796414685580491*^9}, {3.796414832474593*^9, 3.7964148637646*^9}, {
   3.7964807378254766`*^9, 3.7964807627534847`*^9}, {3.796492624464373*^9, 
   3.796492626132923*^9}, 3.7964926702153673`*^9, 3.7964928768832903`*^9, {
   3.8023685706686983`*^9, 3.802368571871327*^9}, {3.8023708298366747`*^9, 
   3.802370831163351*^9}, {3.80238381345644*^9, 3.802383821232895*^9}, {
   3.802389828748969*^9, 3.8023898626824017`*^9}, {3.8023899059475393`*^9, 
   3.802389930698967*^9}, 3.802390027474938*^9, {3.802390683589552*^9, 
   3.802390722203536*^9}, 3.8023908958785906`*^9, 3.80239225991186*^9, 
   3.8023927627768474`*^9, {3.8024341201703725`*^9, 3.802434121658651*^9}, {
   3.802441180546603*^9, 3.8024412040190277`*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"016bef08-dff2-4bcb-90d7-efc44ba52b8e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Viscoplastic subroutines", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.715355912120022*^9, 3.7153559160793324`*^9}, 
   3.715356088427513*^9, {3.802363542464201*^9, 3.802363546239861*^9}, {
   3.802368492043962*^9, 
   3.802368506067648*^9}},ExpressionUUID->"6f3e87a4-9fef-4dc2-b391-\
5d0fb57f61ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "InitializationUState", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"InitializationUState", ",", "HoldAll"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InitializationUState", "[", 
    RowBox[{"wMat_", ",", "uMat_"}], 
    RowBox[{"(*", 
     RowBox[{",", "\[Sigma]_", ",", 
      RowBox[{"\[Epsilon]plas", ":", "_"}]}], "*)"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "ngauss", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ngauss", "=", 
        RowBox[{"Length", "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"ElementIntegrationWeights", "[", 
             RowBox[{"#", ",", "integrationOrder"}], "]"}], "&"}], "/@", 
           "ElementType"}], ")"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wMat", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ndof", ",", "nnp"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"uMat", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ndof", ",", "nnp"}], "}"}]}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"\[Sigma]", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "3", ",", "3"}], "}"}]}], "]"}], 
          "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"nel", ",", "ngauss"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]plas", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"nel", ",", "ngauss"}], "}"}]}], "]"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.80247216350319*^9},ExpressionUUID->"383a8d38-076d-4ce4-9063-0eceadb341d9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "UpdateStrainStress", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UpdateStrainStress", "[", 
     RowBox[{"\[Sigma]_", ",", "\[Epsilon]plas_", ",", "dt_", ",", 
      RowBox[{"BMat", ":", "_"}], ",", 
      RowBox[{"ELEdu", ":", "_"}], ",", "\[Xi]_List"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "gi", ",", "d\[Epsilon]", ",", "de", ",", "S", ",", "\[Sigma]equiv", 
        ",", "sol\[Epsilon]p", ",", "\[CapitalDelta]\[Epsilon]plas", ",", 
        "\[Beta]", ",", "\[Gamma]", ",", "factor", ",", "\[CapitalEpsilon]", 
        ",", "\[Nu]", ",", "Y", ",", "\[Epsilon]0", ",", "\[ScriptN]", ",", 
        "\[ScriptM]", ",", "\[Epsilon]dot0", ",", "\[CapitalKappa]", ",", 
        "\[Lambda]", ",", "\[Mu]", ",", "d\[Sigma]"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\[CapitalEpsilon]", ",", "\[Nu]", ",", "Y", ",", "\[Epsilon]0", ",",
           "\[ScriptN]", ",", "\[ScriptM]", ",", "\[Epsilon]dot0", ",", 
          "\[CapitalKappa]", ",", "\[Lambda]", ",", "\[Mu]"}], "}"}], "=", 
        "MaterialProperty"}], ";", "\[IndentingNewLine]", 
       RowBox[{"gi", "=", 
        RowBox[{"GaussIndex", "@", "\[Xi]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d\[Epsilon]", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"d\[Epsilon]", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}]}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"BMat", "[", "\[Xi]", "]"}], ".", "ELEdu"}], ")"}], "+", 
           
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"BMat", "[", "\[Xi]", "]"}], ".", "ELEdu"}], ")"}], 
            "\[Transpose]"]}], ")"}], "/", "2"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"de", "=", 
        RowBox[{"(", 
         RowBox[{"d\[Epsilon]", "-", 
          RowBox[{
           FractionBox[
            RowBox[{"Tr", "[", "d\[Epsilon]", "]"}], "3"], 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"S", " ", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[Sigma]", "[", 
            RowBox[{"[", "gi", "]"}], "]"}], "-", 
           RowBox[{
            FractionBox[
             RowBox[{"Tr", "[", 
              RowBox[{"\[Sigma]", "[", 
               RowBox[{"[", "gi", "]"}], "]"}], "]"}], "3"], 
            RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], ")"}], "+", 
         RowBox[{
          FractionBox["\[CapitalEpsilon]", 
           RowBox[{"1", "+", "\[Nu]"}]], "de"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]equiv", "=", 
        RowBox[{
         RowBox[{"Sqrt", "[", 
          RowBox[{"3.", "/", "2."}], "]"}], 
         RowBox[{"Norm", "[", 
          RowBox[{"S", ",", "\"\<Frobenius\>\""}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "[", "x", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"sol\[Epsilon]p", "=", 
        RowBox[{"NSolve", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             FractionBox["\[Sigma]equiv", "Y"], "-", 
             RowBox[{
              FractionBox[
               RowBox[{"3", "\[CapitalEpsilon]"}], 
               RowBox[{"2", " ", "Y", " ", 
                RowBox[{"(", 
                 RowBox[{"1", "+", "\[Nu]"}], ")"}]}]], " ", "x"}], "-", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 FractionBox[
                  RowBox[{
                   RowBox[{"\[Epsilon]plas", "[", 
                    RowBox[{"[", "gi", "]"}], "]"}], "+", "x"}], 
                  "\[Epsilon]0"]}], ")"}], 
               RowBox[{"1.", "/", "\[ScriptN]"}]], 
              SuperscriptBox[
               RowBox[{"(", 
                FractionBox["x", 
                 RowBox[{"dt", " ", "\[Epsilon]dot0", " ", 
                  RowBox[{"(*", 
                   RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "Q"}], "/", "k"}], " ", "T"}], "]"}], 
                   "*)"}]}]], ")"}], 
               RowBox[{"1.", "/", "\[ScriptM]"}]]}]}], "\[Equal]", "0"}], "&&", 
           RowBox[{"x", "\[GreaterEqual]", "0"}]}], ",", "x", ",", "Reals"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]\[Epsilon]plas", "=", 
        RowBox[{"x", "/.", 
         RowBox[{"sol\[Epsilon]p", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Beta]", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[Sigma]equiv", ">", "0"}], ",", 
          RowBox[{"1", "-", 
           FractionBox[
            RowBox[{
            "3", " ", "\[CapitalEpsilon]", " ", 
             "\[CapitalDelta]\[Epsilon]plas"}], 
            RowBox[{"2", 
             RowBox[{"(", 
              RowBox[{"1", "+", "\[Nu]"}], ")"}], "\[Sigma]equiv"}]]}], ",", 
          "1.0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d\[Sigma]", "=", 
        RowBox[{
         RowBox[{"\[Beta]", " ", "S"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            FractionBox[
             RowBox[{"Tr", "[", 
              RowBox[{"\[Sigma]", "[", 
               RowBox[{"[", "gi", "]"}], "]"}], "]"}], "3"], "+", 
            RowBox[{"\[CapitalKappa]", " ", 
             RowBox[{"Tr", "[", "d\[Epsilon]", "]"}]}]}], ")"}], " ", 
          RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "-", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"[", "gi", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"d\[Sigma]", ",", "\[CapitalDelta]\[Epsilon]plas"}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "UpdateStates", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UpdateStates", "[", 
   RowBox[{
   "\[Sigma]_", ",", "\[Epsilon]plas_", ",", "e0_", ",", "wMat_", ",", "dt_", 
    ",", "ElTypId_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"e", "=", "e0"}], ",", "B", ",", "BMat", ",", "ELEu", ",", 
      "coord"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"B", "=", 
      RowBox[{"IEN", "[", 
       RowBox[{"[", 
        RowBox[{"ElTypId", ",", ";;", ",", "e"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"coord", "=", 
      RowBox[{"Coords", "[", 
       RowBox[{"[", "B", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"BMat", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dN", "@@", "#"}], ")"}], ".", "coord"}], "]"}], ".", 
         RowBox[{"dN", "@@", "#"}]}], ")"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ELEu", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"wMat", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "B"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"UpdateStrainStress", "[", 
        RowBox[{
        "\[Sigma]", ",", "\[Epsilon]plas", ",", "dt", ",", "BMat", ",", 
         "ELEu", ",", "#"}], "]"}], "&"}], "/@", "GuassPointsNatural"}]}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{{3.793312414930255*^9, 3.793312482731543*^9}, {
   3.793313326138242*^9, 3.793313327016553*^9}, {3.7938046911339083`*^9, 
   3.7938047305324287`*^9}, {3.793804841184092*^9, 3.793804841447917*^9}, {
   3.793804876953855*^9, 3.793804886746345*^9}, {3.79380505651079*^9, 
   3.793805107120332*^9}, {3.793805149689662*^9, 3.793805228477165*^9}, {
   3.7938067675597677`*^9, 3.793806794782155*^9}, {3.7938068559471607`*^9, 
   3.793806857771006*^9}, {3.793807139811202*^9, 3.793807155628137*^9}, {
   3.793807327593946*^9, 3.793807426506983*^9}, {3.793807509935306*^9, 
   3.793807552671719*^9}, {3.793807584993424*^9, 3.79380761231015*^9}, {
   3.793807703925989*^9, 3.7938077199091*^9}, {3.793810670303265*^9, 
   3.793810677236535*^9}, {3.7938108633954897`*^9, 3.793810889554409*^9}, 
   3.793810971376513*^9, {3.793811003919468*^9, 3.793811016680489*^9}, {
   3.793811054505879*^9, 3.793811138635181*^9}, {3.793811208535445*^9, 
   3.793811261326477*^9}, {3.7938113186829233`*^9, 3.7938113752739983`*^9}, {
   3.79381146762729*^9, 3.793811476508407*^9}, 3.7938115495924683`*^9, {
   3.793811834282887*^9, 3.7938118645061417`*^9}, {3.79381189612228*^9, 
   3.7938119101794033`*^9}, {3.793812121988791*^9, 3.793812126234168*^9}, {
   3.793812191635921*^9, 3.793812192595286*^9}, {3.7938123310079308`*^9, 
   3.7938124004512863`*^9}, {3.7938124755757427`*^9, 
   3.7938124917511797`*^9}, {3.7938127103610373`*^9, 
   3.7938127118120832`*^9}, {3.793812805497115*^9, 3.79381284572164*^9}, {
   3.793812981069058*^9, 3.793812999093711*^9}, 3.793813029631207*^9, 
   3.7938130609214983`*^9, {3.79381310904136*^9, 3.793813148356039*^9}, {
   3.793813315447496*^9, 3.793813318934965*^9}, {3.7938134577507467`*^9, 
   3.793813489198464*^9}, {3.793813527665221*^9, 3.7938135511522427`*^9}, {
   3.793813632066996*^9, 3.79381363313983*^9}, {3.793813752984619*^9, 
   3.793813825072781*^9}, {3.793813884962555*^9, 3.793813893281354*^9}, 
   3.7938139793575706`*^9, {3.793814068008057*^9, 3.793814089846696*^9}, {
   3.793814122793501*^9, 3.793814159914556*^9}, {3.793814334799244*^9, 
   3.793814390844679*^9}, {3.793814440972719*^9, 3.7938148314970503`*^9}, {
   3.79381489940394*^9, 3.793814955738553*^9}, {3.7938150828515043`*^9, 
   3.793815106593665*^9}, {3.793815138066759*^9, 3.7938151768929996`*^9}, {
   3.793815233091839*^9, 3.793815233717361*^9}, {3.793815380241811*^9, 
   3.793815410540317*^9}, {3.793815697611724*^9, 3.7938158048125153`*^9}, 
   3.7938159648236933`*^9, {3.7938162251668987`*^9, 3.7938162674277782`*^9}, 
   3.79381632548801*^9, {3.79381635889779*^9, 3.793816409164865*^9}, 
   3.793816471599225*^9, {3.793816781060658*^9, 3.793816785802322*^9}, {
   3.793817356880804*^9, 3.793817357117115*^9}, {3.793817706860291*^9, 
   3.793817732376149*^9}, {3.7938177811292477`*^9, 3.793817782191416*^9}, {
   3.793817878290914*^9, 3.7938179007852173`*^9}, {3.793818283602191*^9, 
   3.793818308857656*^9}, {3.793818342330567*^9, 3.7938184131371717`*^9}, 
   3.7938190576091223`*^9, {3.7938191214329863`*^9, 3.793819167761849*^9}, {
   3.793819285596223*^9, 3.7938193215400963`*^9}, {3.793819470450526*^9, 
   3.7938195006254597`*^9}, {3.793819531482374*^9, 3.793819535969645*^9}, {
   3.793819683047003*^9, 3.793819730286942*^9}, {3.7938198110194187`*^9, 
   3.793819820418338*^9}, {3.793823722094142*^9, 3.793823722397973*^9}, {
   3.793823970052415*^9, 3.793824068395213*^9}, {3.7938284072937593`*^9, 
   3.793828407465343*^9}, {3.793830695408679*^9, 3.793830707251841*^9}, {
   3.79387992016964*^9, 3.793879951443068*^9}, {3.7938800037955427`*^9, 
   3.79388009683038*^9}, {3.793916072085672*^9, 3.793916079226975*^9}, {
   3.794500906065949*^9, 3.794501040604981*^9}, {3.794501090853438*^9, 
   3.794501134303973*^9}, {3.794501680274601*^9, 3.794501686328144*^9}, 
   3.7945017573066072`*^9, {3.79450204834027*^9, 3.794502051108161*^9}, {
   3.79450321240757*^9, 3.794503220061603*^9}, {3.794503393791169*^9, 
   3.794503429989151*^9}, {3.7957308992699757`*^9, 3.795730902156196*^9}, {
   3.7957319660090923`*^9, 3.795731967513464*^9}, {3.795732622874792*^9, 
   3.79573263153761*^9}, {3.795732669007276*^9, 3.795732677086013*^9}, {
   3.795733162510436*^9, 3.795733164078148*^9}, {3.79578585215104*^9, 
   3.7957858550046883`*^9}, {3.795785928553431*^9, 3.7957859289435263`*^9}, {
   3.795786746391839*^9, 3.79578675004632*^9}, {3.795797841234269*^9, 
   3.795797849377082*^9}, {3.7957983392513523`*^9, 3.795798339553151*^9}, {
   3.7958032849048367`*^9, 3.795803368281461*^9}, {3.795803533738206*^9, 
   3.795803582352461*^9}, 3.7958036189709682`*^9, {3.795878593486264*^9, 
   3.7958787278818817`*^9}, {3.795879056595395*^9, 3.795879056909874*^9}, {
   3.795880672858368*^9, 3.7958806730269833`*^9}, {3.795883706449641*^9, 
   3.7958837079394007`*^9}, {3.795884054147273*^9, 3.795884110548414*^9}, {
   3.795884183917485*^9, 3.795884184254331*^9}, {3.795884227302202*^9, 
   3.795884228462473*^9}, 3.795884957159851*^9, {3.795885044670084*^9, 
   3.7958850465015497`*^9}, {3.795887325700604*^9, 3.795887336768312*^9}, {
   3.795888948198344*^9, 3.7958889507483397`*^9}, {3.7958889859746733`*^9, 
   3.795888997517632*^9}, {3.795889253750669*^9, 3.7958892711438513`*^9}, {
   3.7958893266346684`*^9, 3.79588934870621*^9}, {3.7958895320257187`*^9, 
   3.7958895493267317`*^9}, {3.795890791063676*^9, 3.795890791989972*^9}, {
   3.795890825368848*^9, 3.795890825727715*^9}, {3.795890899362989*^9, 
   3.795890928387755*^9}, {3.7958915385006247`*^9, 3.795891555975667*^9}, {
   3.795891888520817*^9, 3.795891994602365*^9}, {3.795892078619269*^9, 
   3.7958920809725513`*^9}, {3.795892394198845*^9, 3.7958923952379208`*^9}, {
   3.795892433414774*^9, 3.795892462751419*^9}, {3.7958924944794493`*^9, 
   3.795892587405079*^9}, {3.795892626225244*^9, 3.795892631990765*^9}, {
   3.7958927209142523`*^9, 3.7958928071697893`*^9}, {3.795892895018756*^9, 
   3.795892927866674*^9}, {3.7958929594931517`*^9, 3.7958929876859093`*^9}, {
   3.795893176055046*^9, 3.79589317846705*^9}, {3.795893420645151*^9, 
   3.795893465973275*^9}, {3.795900651935256*^9, 3.795900663489555*^9}, {
   3.795904826497075*^9, 3.795904828912053*^9}, 3.795905140179047*^9, {
   3.795905240925729*^9, 3.795905245142651*^9}, {3.79590529784766*^9, 
   3.79590538548804*^9}, {3.795906096170027*^9, 3.7959060983842497`*^9}, {
   3.79641590981146*^9, 3.796415916043139*^9}, {3.796416026666521*^9, 
   3.7964160910102177`*^9}, {3.796416146350326*^9, 3.796416151018303*^9}, {
   3.796416225574823*^9, 3.796416315107422*^9}, {3.796416367595536*^9, 
   3.796416393570915*^9}, {3.796416424235589*^9, 3.796416430552475*^9}, {
   3.796417014102092*^9, 3.796417015501936*^9}, {3.796417085696776*^9, 
   3.7964170908423967`*^9}, {3.796417128474832*^9, 3.7964172372757483`*^9}, {
   3.796417491423337*^9, 3.796417493229164*^9}, {3.796419643416164*^9, 
   3.796419666435494*^9}, {3.7964739002861757`*^9, 3.796473905261223*^9}, {
   3.796473959672496*^9, 3.796473959902659*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"d0da422e-6d14-4ba6-a5ab-d786f28cdf2d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CalState", "[", 
    RowBox[{
    "\[Sigma]_", ",", "\[Epsilon]plas_", ",", "wMat_", ",", "dt_", ",", 
     "ElTypId_"}], "]"}], ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "GuassPointsNatural", ",", "GaussIndex", ",", "GuassWeights", ",", 
       "NMat", ",", "dN", ",", "dState", ",", "d\[Sigma]", ",", 
       "d\[Epsilon]plas"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DefineGaussAndSFInfo", "[", 
       RowBox[{
        RowBox[{"ElementType", "[", 
         RowBox[{"[", "ElTypId", "]"}], "]"}], ",", "elementOrder"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dState", "=", 
       RowBox[{"(*", "Parallel", "*)"}], 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"UpdateStates", "[", 
           RowBox[{
            RowBox[{"\[Sigma]", "[", 
             RowBox[{"[", "#", "]"}], "]"}], ",", 
            RowBox[{"\[Epsilon]plas", "[", 
             RowBox[{"[", "#", "]"}], "]"}], ",", "#", ",", "wMat", ",", "dt",
             ",", "ElTypId"}], "]"}], "&"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{"nel", "[", 
           RowBox[{"[", "ElTypId", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d\[Sigma]", "=", 
       RowBox[{"dState", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", ";;", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d\[Epsilon]plas", "=", 
       RowBox[{"dState", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", ";;", ",", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"d\[Sigma]", ",", "d\[Epsilon]plas"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParallelUpdateStates", "[", 
   RowBox[{
   "\[Sigma]in_", ",", "\[Epsilon]plasin_", ",", "wMat_", ",", "dt_"}], "]"}],
   ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Sigma]", "=", "\[Sigma]in"}], ",", 
      RowBox[{"\[Epsilon]plas", "=", "\[Epsilon]plasin"}], ",", "dState", ",",
       "d\[Sigma]", ",", "d\[Epsilon]plas"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dState", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"CalState", "[", 
         RowBox[{
          RowBox[{"\[Sigma]", "[", 
           RowBox[{"[", "#", "]"}], "]"}], ",", 
          RowBox[{"\[Epsilon]plas", "[", 
           RowBox[{"[", "#", "]"}], "]"}], ",", "wMat", ",", "dt", ",", "#"}],
          "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", "nElTyp", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"d\[Sigma]", "=", 
      RowBox[{"dState", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"d\[Epsilon]plas", "=", 
      RowBox[{"dState", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"\[Sigma]", "+=", "d\[Sigma]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Epsilon]plas", "+=", "d\[Epsilon]plas"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Sigma]", ",", "\[Epsilon]plas"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{
  3.802472175377185*^9},ExpressionUUID->"d8ce27f8-772b-4375-a4a7-\
86c77348b64b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Define Geometry Dimensions , Material Properties and Mesh", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.7149112840702*^9, 3.71491129205448*^9}, 
   3.714926705046982*^9, {3.7153561117921677`*^9, 3.715356159209116*^9}, {
   3.789409038388266*^9, 
   3.78940904100842*^9}},ExpressionUUID->"54d6952a-b370-41dc-b8d8-\
ea6b81166a2e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "InitializeFEM", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InitializeFEM", "[", 
    RowBox[{"mesh_ElementMesh", ",", "\[CapitalEpsilon]_", ",", "\[Nu]_"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalKappa]", ",", "\[Lambda]", ",", "\[Mu]"}], "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[CapitalKappa]", "=", 
       FractionBox["\[CapitalEpsilon]", 
        RowBox[{"3", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", "\[Nu]"}]}], ")"}]}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Lambda]", "=", 
       FractionBox[
        RowBox[{"\[CapitalEpsilon]", " ", "\[Nu]"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", "\[Nu]"}], ")"}], 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", "\[Nu]"}]}], ")"}]}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Mu]", "=", 
       FractionBox[
        RowBox[{"\[CapitalEpsilon]", " "}], 
        RowBox[{"2", 
         RowBox[{"(", 
          RowBox[{"1", "+", "\[Nu]"}], ")"}]}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{"C10", " ", "=", " ", 
       FractionBox["\[Mu]", "2."]}], ";", "\[IndentingNewLine]", 
      RowBox[{"D1", " ", "=", " ", 
       FractionBox["2.", "\[CapitalKappa]"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ElementType", " ", "=", 
       RowBox[{"Head", "/@", 
        RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nElTyp", "=", 
       RowBox[{"Length", "@", "ElementType"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"elementOrder", "=", 
       RowBox[{"mesh", "[", "\"\<MeshOrder\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Coords", "=", 
       RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"IEN", "=", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"List", ",", 
             RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "1"}], "]"}], "]"}], "\[Transpose]"], "&"}], "/@", 
        RowBox[{"Range", "[", "nElTyp", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nnp", ",", "ndof"}], "}"}], "=", 
       RowBox[{"Dimensions", "@", "Coords"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nen", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Dimensions", "/@", "IEN"}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nel", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Dimensions", "/@", "IEN"}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"IENS", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", 
           RowBox[{"mesh", "[", "\"\<BoundaryElements\>\"", "]"}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Transpose]"}]}], " ", ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nsen", ",", "nsel"}], "}"}], "=", 
       RowBox[{"Dimensions", "@", "IENS"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"\[ScriptCapitalI]", "=", 
         RowBox[{"IdentityMatrix", "[", "ndof", "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[DoubleStruckCapitalI]0", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox["1", "2."], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              TemplateBox[{
                RowBox[{"i", ",", "r"}]},
               "KroneckerDeltaSeq"], 
              TemplateBox[{
                RowBox[{"j", ",", "s"}]},
               "KroneckerDeltaSeq"]}], "+", 
             RowBox[{
              TemplateBox[{
                RowBox[{"i", ",", "s"}]},
               "KroneckerDeltaSeq"], " ", 
              TemplateBox[{
                RowBox[{"j", ",", "r"}]},
               "KroneckerDeltaSeq"]}]}], ")"}]}], "-", 
          RowBox[{
           FractionBox["1", "3."], 
           TemplateBox[{
             RowBox[{"i", ",", "j"}]},
            "KroneckerDeltaSeq"], 
           TemplateBox[{
             RowBox[{"r", ",", "s"}]},
            "KroneckerDeltaSeq"]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"r", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", "3"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalI]", "=", 
       RowBox[{
        RowBox[{"IdentityMatrix", "[", "3", "]"}], "\[TensorProduct]", 
        RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "  ", "\[Mu]", " ", "\[DoubleStruckCapitalI]0"}], "+", 
          
          RowBox[{"\[CapitalKappa]", " ", "\[ScriptCapitalI]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{";;", "ndof"}], ",", 
          RowBox[{";;", "ndof"}], ",", 
          RowBox[{";;", "ndof"}], ",", 
          RowBox[{";;", "ndof"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StiffnessVol", "=", 
       RowBox[{"\[CapitalKappa]", " ", 
        RowBox[{"\[ScriptCapitalI]", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}]}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StiffnessDev", "=", 
       RowBox[{"2", "  ", "\[Mu]", " ", 
        RowBox[{"\[DoubleStruckCapitalI]0", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}], ",", 
           RowBox[{";;", "ndof"}]}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "\[CapitalEpsilon]", ",", "\[Nu]", ",", "\[CapitalKappa]", ",", 
        "\[Lambda]", ",", "\[Mu]"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.793312650282329*^9, 3.7933126504544353`*^9}, {
   3.793312682616867*^9, 3.793312683248705*^9}, {3.793312714531828*^9, 
   3.793312748751926*^9}, {3.79336199068841*^9, 3.79336203346084*^9}, 
   3.793802556814089*^9, {3.793802625516*^9, 3.793802642146557*^9}, {
   3.793803030745356*^9, 3.7938030310585403`*^9}, {3.793804003481904*^9, 
   3.793804029184219*^9}, {3.793804372858542*^9, 3.793804389867641*^9}, {
   3.793804488063105*^9, 3.7938045096385117`*^9}, {3.793805271710178*^9, 
   3.7938052727268248`*^9}, {3.793806908581924*^9, 3.793806908867786*^9}, {
   3.793816807272901*^9, 3.7938168326829147`*^9}, 3.7938168852067547`*^9, {
   3.793824110643874*^9, 3.7938241493627157`*^9}, {3.793832219540161*^9, 
   3.793832220602107*^9}, {3.793883112999173*^9, 3.793883118270282*^9}, {
   3.79389957866289*^9, 3.7938996069196987`*^9}, {3.7938997185640182`*^9, 
   3.793899730147066*^9}, {3.793899833818098*^9, 3.793899835358363*^9}, {
   3.793900031718175*^9, 3.793900039059495*^9}, {3.793904466504747*^9, 
   3.7939045193091383`*^9}, {3.793904580298193*^9, 3.793904580655964*^9}, {
   3.793904636749007*^9, 3.793904645321824*^9}, {3.79390513120159*^9, 
   3.793905132124722*^9}, {3.793905261303667*^9, 3.793905261469936*^9}, {
   3.793905717812716*^9, 3.793905717955986*^9}, {3.793905962598134*^9, 
   3.793906034030904*^9}, {3.793909156587523*^9, 3.793909158117461*^9}, {
   3.793909311961824*^9, 3.793909324776376*^9}, 3.7939153673833714`*^9, {
   3.793915671293165*^9, 3.793915678896468*^9}, {3.793915978818741*^9, 
   3.793915979199959*^9}, {3.793917246533787*^9, 3.793917249508089*^9}, {
   3.793917301448203*^9, 3.793917352111455*^9}, {3.793917962809338*^9, 
   3.79391796814529*^9}, {3.793992546946763*^9, 3.793992549928288*^9}, {
   3.793992651973859*^9, 3.793992652243301*^9}, {3.793992824041461*^9, 
   3.793992824168215*^9}, {3.794003524580482*^9, 3.794003531011443*^9}, 
   3.794003563895431*^9, {3.794061967899053*^9, 3.794061975730422*^9}, {
   3.794062314419424*^9, 3.794062314681863*^9}, {3.794062354806382*^9, 
   3.794062388467551*^9}, {3.794066638762436*^9, 3.794066641096867*^9}, {
   3.794160723054883*^9, 3.794160723648397*^9}, {3.794163679612616*^9, 
   3.7941636798282623`*^9}, {3.7944994093795443`*^9, 
   3.7944994237925177`*^9}, {3.794500492906773*^9, 3.7945004934723253`*^9}, {
   3.7945012853258*^9, 3.7945012884979773`*^9}, {3.794501576981185*^9, 
   3.794501577531307*^9}, {3.7945033059627867`*^9, 3.7945033092437267`*^9}, 
   3.794503456350737*^9, {3.794503964136004*^9, 3.794503964278133*^9}, {
   3.7957332574255*^9, 3.795733410087817*^9}, {3.795733476569172*^9, 
   3.795733482457563*^9}, {3.795780910652372*^9, 3.795780910842649*^9}, {
   3.795785631318584*^9, 3.795785631483221*^9}, {3.795797914701725*^9, 
   3.795797921435354*^9}, {3.795798127836903*^9, 3.7957981573617163`*^9}, {
   3.795804342842306*^9, 3.795804343207602*^9}, 3.795806693661755*^9, {
   3.7958785220071993`*^9, 3.795878522154974*^9}, {3.7958793915525713`*^9, 
   3.795879631154767*^9}, {3.79587966129046*^9, 3.795879683211454*^9}, {
   3.79588003655774*^9, 3.795880126568226*^9}, {3.795880163436965*^9, 
   3.795880210638611*^9}, {3.7958802552594233`*^9, 3.795880303603922*^9}, {
   3.79588034390162*^9, 3.795880381239077*^9}, {3.795880451330162*^9, 
   3.7958804631925364`*^9}, {3.795880503427862*^9, 3.7958806047977867`*^9}, 
   3.7958807623633204`*^9, {3.795880894015327*^9, 3.79588091834709*^9}, {
   3.795880975631056*^9, 3.795880975977675*^9}, 3.795881043903336*^9, {
   3.795884271414651*^9, 3.7958842832905493`*^9}, {3.79588463025842*^9, 
   3.7958846602220497`*^9}, {3.7958847423596153`*^9, 3.795884770392796*^9}, {
   3.7958848042239323`*^9, 3.795884854449605*^9}, {3.795885244059288*^9, 
   3.795885268067255*^9}, 3.795885311841188*^9, {3.795885346192668*^9, 
   3.795885348751598*^9}, {3.795885381626047*^9, 3.795885402537201*^9}, {
   3.795885436018629*^9, 3.795885476980708*^9}, {3.795885537702888*^9, 
   3.795885538010726*^9}, {3.795886038092407*^9, 3.795886044694803*^9}, 
   3.795886086348947*^9, {3.79588654688737*^9, 3.795886572975697*^9}, {
   3.795886913821933*^9, 3.795886919233593*^9}, {3.795886969628828*^9, 
   3.795887023987152*^9}, 3.795887154078703*^9, {3.795887273031505*^9, 
   3.795887287816845*^9}, 3.795887428773533*^9, {3.795887474311722*^9, 
   3.79588750947092*^9}, {3.795887553409603*^9, 3.7958875616265917`*^9}, 
   3.795887596119079*^9, 3.7958896200526323`*^9, 3.795892161448332*^9, {
   3.7958930011940517`*^9, 3.795893002310235*^9}, {3.795893267759162*^9, 
   3.795893295132016*^9}, {3.795900426358296*^9, 3.7959004340821047`*^9}, {
   3.795904828211041*^9, 3.795904830866798*^9}, {3.795905242912623*^9, 
   3.795905245567823*^9}, {3.795905666011056*^9, 3.795905667584485*^9}, {
   3.7959580009591627`*^9, 3.79595801617572*^9}, {3.795958549670898*^9, 
   3.79595856540343*^9}, {3.79595874731961*^9, 3.795958755038939*^9}, {
   3.795959353352709*^9, 3.795959356142063*^9}, {3.7959594271112967`*^9, 
   3.795959436962681*^9}, {3.79596044514961*^9, 3.795960448075791*^9}, 
   3.795976695996616*^9, {3.795978393949881*^9, 3.7959784003497887`*^9}, {
   3.796060948954699*^9, 3.796060983364126*^9}, {3.796412248809101*^9, 
   3.7964122857608957`*^9}, {3.796412361420659*^9, 3.796412444670602*^9}, {
   3.7964125146476307`*^9, 3.796412537063788*^9}, {3.7964126763171864`*^9, 
   3.796412711087229*^9}, {3.796412784112534*^9, 3.796412804007247*^9}, {
   3.7964131733089857`*^9, 3.796413216733173*^9}, {3.796413326602604*^9, 
   3.7964133270079117`*^9}, 3.796413369651553*^9, {3.796413560586451*^9, 
   3.796413561223888*^9}, {3.796413830734377*^9, 3.796413833985888*^9}, {
   3.7964138786970177`*^9, 3.796413916885831*^9}, {3.7964800120391808`*^9, 
   3.796480041568575*^9}, {3.796480187589858*^9, 3.796480254975758*^9}, {
   3.796480301337253*^9, 3.79648030904533*^9}, 3.796482608357353*^9, {
   3.7964921731621017`*^9, 3.79649219170409*^9}, {3.796498430568201*^9, 
   3.796498430742771*^9}, {3.8023620332257633`*^9, 3.802362038972859*^9}, {
   3.802362214685239*^9, 3.802362215692017*^9}, {3.802370689089999*^9, 
   3.802370711528735*^9}, 3.802373774439673*^9, {3.802376545924819*^9, 
   3.802376556578751*^9}, {3.802379254232841*^9, 3.802379257832747*^9}, 
   3.80238247882753*^9, {3.8023845835343857`*^9, 3.802384601497136*^9}, {
   3.802384638582737*^9, 3.802384668305044*^9}, {3.802384792242581*^9, 
   3.8023847950797577`*^9}, 3.80239150719475*^9, {3.8023916778232765`*^9, 
   3.8023916800134864`*^9}, 3.8023926963536367`*^9, {3.802392749976519*^9, 
   3.802392752678694*^9}, {3.8023930641195493`*^9, 3.8023930718144765`*^9}, {
   3.8024284899893303`*^9, 3.8024284903636026`*^9}, {3.8024293695184402`*^9, 
   3.802429379242528*^9}, {3.802439718835121*^9, 3.802439721506669*^9}, {
   3.802441144844122*^9, 3.802441170819025*^9}, {3.802441211653818*^9, 
   3.8024412118518763`*^9}, {3.802472179868425*^9, 3.802472180202859*^9}, {
   3.802473278007701*^9, 3.802473299312591*^9}, {3.818937984701805*^9, 
   3.818937987845962*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"8af358d9-2e76-43ff-a436-9f72e8c83cf5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "NewtonSolve", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewtonSolve", "[", 
    RowBox[{
    "nsteps_", ",", "TimePeriod_", ",", "\[Alpha]_", ",", "TracInd_", ",", 
     "ConcenInd_", ",", 
     RowBox[{"MaxItr_", ":", "200"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       ",", "dt", ",", "LoadStep", ",", "LoadInc", ",", "Load", ",", "itr", 
        ",", "Err", ",", "rMat", ",", "KMat", ",", "udsol", ",", "udMat", ",",
         "Ufvec", ",", "\[IndentingNewLine]", "wMat", ",", "uMat", ",", 
        "\[Sigma]", ",", "\[Epsilon]plas", ",", "DirichletBC", ",", 
        "NeumannBC", ",", "StressMatflocal", "\[IndentingNewLine]", ",", 
        "Fd"}], "*)"}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dt", ",", "LoadStep", ",", "LoadInc"}], "}"}], "=", 
       RowBox[{"DefineLoadStep", "[", 
        RowBox[{"0", ",", "1", ",", "nsteps", ",", "TimePeriod"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"uMat", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ndof", ",", "nnp"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Fd", "=", 
       RowBox[{"Reap", "@", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"itr", "=", "0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Step No. = \>\"", ",", "\[ScriptI]"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<LoadFactor = \>\"", ",", 
             RowBox[{"LoadStep", "[", 
              RowBox[{"[", "\[ScriptI]", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"DirichletBC", "=", 
            RowBox[{"AssociationThread", "[", 
             RowBox[{"DirichletPoints", "->", 
              RowBox[{
               RowBox[{"LoadStep", "[", 
                RowBox[{"[", "\[ScriptI]", "]"}], "]"}], "DirichletVals"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"NeumannBC", "=", 
            RowBox[{"AssociationThread", "[", 
             RowBox[{"NeumannPoints", "\[Rule]", 
              RowBox[{
               RowBox[{"LoadStep", "[", 
                RowBox[{"[", "\[ScriptI]", "]"}], "]"}], "NeumannVals"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"uMat", "=", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"uMat", ",", " ", "DirichletBC"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Err", ",", "rMat"}], "}"}], "=", 
            RowBox[{"ParallelResidual", "[", 
             RowBox[{"uMat", ",", "dt", ",", "TracInd", ",", "ConcenInd"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"rMat", "//", "Normal"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Err", ">", "tol"}], "&&", 
              RowBox[{
               RowBox[{"itr", "++"}], "<", "MaxItr"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"KMat", "=", 
               RowBox[{"ParallelStiffness", "[", 
                RowBox[{"uMat", ",", "dt"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"udsol", "=", 
               RowBox[{"LinearSolve", "[", 
                RowBox[{
                 RowBox[{"KMat", "[", 
                  RowBox[{"[", 
                   RowBox[{"IDno", ",", "IDno"}], "]"}], "]"}], ",", 
                 RowBox[{"rMat", "[", 
                  RowBox[{"[", "IDno", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"udMat", "=", 
               RowBox[{"SparseArray", "[", 
                RowBox[{
                 RowBox[{"{", "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ndof", "*", "nnp"}], "}"}], ",", "0.0"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"udMat", "[", 
                RowBox[{"[", "IDno", "]"}], "]"}], "=", "udsol"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"uMat", "+=", 
               RowBox[{"\[Alpha]", " ", 
                SuperscriptBox[
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{"udMat", ",", 
                   RowBox[{"{", 
                    RowBox[{"nnp", ",", "ndof"}], "}"}]}], "]"}], 
                 "\[Transpose]"]}]}], ";", 
              RowBox[{"(*", 
               RowBox[{"ndof", " ", "\[Times]", " ", "nnp"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Err", ",", "rMat"}], "}"}], "=", 
               RowBox[{"ParallelResidual", "[", 
                RowBox[{"uMat", ",", "dt", ",", "TracInd", ",", "ConcenInd"}],
                 "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Iteration: \>\"", ",", "itr", ",", 
                "\"\<. \\n Norm of residual for u : \>\"", ",", "Err"}], 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Err", "<", "tol"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Compute u Converged!\>\"", "]"}], 
              ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Compute u Not Converged!\>\"", "]"}],
               ";", 
              RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Sow", "[", "uMat", "]"}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"\[ScriptI]", ",", "nsteps"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Fd", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PostProcess", "[", 
   RowBox[{"Fd_", ",", "mesh_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "UMat", ",", "Ufvec", ",", "PltDeformation", ",", "ElasticEnergy"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"UMat", " ", "=", " ", 
      RowBox[{"Fd", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ufvec", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ElementMeshInterpolation", "[", 
         RowBox[{
          RowBox[{"{", "mesh", "}"}], ",", " ", 
          RowBox[{
           RowBox[{"UMat", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", ";;"}], "]"}], "]"}], "//", "Normal"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PltDeformation", " ", "=", " ", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"mesh", "[", "\"\<Wireframe\>\"", "]"}], ",", 
        RowBox[{
         RowBox[{"ElementMeshDeformation", "[", 
          RowBox[{"mesh", ",", "Ufvec", ",", 
           RowBox[{"\"\<ScalingFactor\>\"", "\[Rule]", "1"}]}], "]"}], "[", 
         RowBox[{"\"\<Wireframe\>\"", "[", 
          RowBox[{"\"\<MeshElementStyle\>\"", "\[Rule]", 
           RowBox[{"EdgeForm", "[", "Red", "]"}]}], "]"}], "]"}], ",", 
        RowBox[{"ViewPoint", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1.5", ",", "1", ",", "1"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "PltDeformation", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ElasticEnergy", "=", 
      RowBox[{
       FractionBox[
        RowBox[{"-", "1"}], "2"], 
       RowBox[{"Plus", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"CalEE", "[", 
            RowBox[{"uMat", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "@", "nElTyp"}]}], ")"}]}]}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.796330958340686*^9, 3.796330989290716*^9}, {
   3.796404724667136*^9, 3.79640482294215*^9}, {3.796404894880095*^9, 
   3.796405078317412*^9}, {3.7964085266392508`*^9, 3.7964085842259502`*^9}, {
   3.796409051056447*^9, 3.7964092209223967`*^9}, {3.796409270265791*^9, 
   3.796409395500659*^9}, {3.796409568775693*^9, 3.7964095772636843`*^9}, {
   3.796409617311947*^9, 3.796409671956053*^9}, {3.796410164166457*^9, 
   3.7964102012937737`*^9}, {3.796410436350884*^9, 3.796410436443769*^9}, {
   3.7964105067259274`*^9, 3.7964105130770473`*^9}, {3.7964109735668097`*^9, 
   3.79641104250189*^9}, {3.796414237126978*^9, 3.796414243761668*^9}, 
   3.796417994351398*^9, {3.796419319785432*^9, 3.79641931992951*^9}, {
   3.796478713615526*^9, 3.7964787137975807`*^9}, {3.796478754976906*^9, 
   3.7964787946325407`*^9}, 3.796479229071535*^9, {3.79647972242997*^9, 
   3.7964797232998667`*^9}, {3.7964807278953533`*^9, 
   3.7964807282167683`*^9}, {3.7964823848537283`*^9, 3.796482435084982*^9}, {
   3.7964927040400867`*^9, 3.796492711407175*^9}, {3.796492830018367*^9, 
   3.796492853272682*^9}, 3.796493190098172*^9, {3.796493351970717*^9, 
   3.796493352524177*^9}, {3.796495222066481*^9, 3.796495272128407*^9}, 
   3.796495440214533*^9, {3.79649572360956*^9, 3.796495738558935*^9}, 
   3.7964959593610487`*^9, {3.796496928727806*^9, 3.796496934764019*^9}, 
   3.7964982626524677`*^9, 3.796498309750259*^9, {3.796498340347698*^9, 
   3.7964983729713306`*^9}, {3.7964984466066504`*^9, 3.796498449662156*^9}, 
   3.796498956651181*^9, 3.802363793070929*^9, 3.802363928105019*^9, 
   3.8023708956917973`*^9, {3.802372947118314*^9, 3.802372968244528*^9}, 
   3.8023760584328127`*^9, 3.8023761545812607`*^9, {3.802382769239279*^9, 
   3.802382769382288*^9}, {3.802383235384562*^9, 3.802383240022274*^9}, {
   3.802383277907209*^9, 3.8023833143864737`*^9}, 3.8023833908791513`*^9, {
   3.802383444874452*^9, 3.802383445565303*^9}, {3.802383483317643*^9, 
   3.802383563761128*^9}, {3.802383663942973*^9, 3.802383664683284*^9}, {
   3.8023838249466753`*^9, 3.802383845649126*^9}, {3.802384672894805*^9, 
   3.802384716357589*^9}, {3.8023859454776154`*^9, 3.802385956935293*^9}, 
   3.8023860663192215`*^9, {3.8023876674438972`*^9, 3.8023876680800686`*^9}, 
   3.802428373698536*^9, 3.8024307570772057`*^9, {3.8024505388069696`*^9, 
   3.802450555555901*^9}, 3.802465417478125*^9, {3.8189408465397987`*^9, 
   3.818940853920683*^9}, {3.818940892815424*^9, 3.818940897466268*^9}, {
   3.818940992589306*^9, 3.8189409931734657`*^9}, {3.8189423502339582`*^9, 
   3.818942350745531*^9}, {3.818942599786154*^9, 3.818942607985311*^9}, {
   3.818943265323058*^9, 3.818943265629589*^9}, {3.819025485583476*^9, 
   3.819025486403522*^9}, {3.8190255717743397`*^9, 3.819025572108787*^9}, {
   3.819026245884335*^9, 3.81902624632689*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"54ece23b-6e14-4698-886c-04e54342e536"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DefineBCs2", "[", 
   RowBox[{"uVec_", ",", "tVec_", ",", "L_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"tol", "=", 
       SuperscriptBox["10", 
        RowBox[{"-", "5"}]]}], ",", "IDArray"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DirichletPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Bttm", ",", "BttmRit", ",", "Lft", ",", "Bck", ",", "Rit", ",", 
          "RitBttm", ",", "Tp", ",", "Nodes"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Bttm", " ", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "0.0"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Lft", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "1"}], "]"}], "]"}], "-", "0.0"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Bttm"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", "Lft"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", "Lft"}]}], 
           "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DirichletDof", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DirichletPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"DirichletPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NeumannPoints", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Tp", ",", "TpRit", ",", "Frnt", ",", "ETp", ",", "ERit", ",", 
          "EFrnt", ",", "Nodes"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Tp", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "L"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"TpRit", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{
               RowBox[{"Coords", "[", 
                RowBox[{"[", 
                 RowBox[{"Tp", ",", "1"}], "]"}], "]"}], "-", "L"}], "]"}], 
             ",", 
             RowBox[{"x_", "/;", 
              RowBox[{"x", "<", "tol"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Nodes", " ", "=", "  ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "&"}], "/@", 
             RowBox[{"Tp", "[", 
              RowBox[{"[", "TpRit", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "#"}], "}"}], "&"}], "/@", 
             RowBox[{"Tp", "[", 
              RowBox[{"[", "TpRit", "]"}], "]"}]}]}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NeumannDof", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NeumannPoints", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], "-", "1"}], ")"}], "*", 
         "ndof"}], "+", 
        RowBox[{"NeumannPoints", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DirichletVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"uVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "DirichletPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NeumannVals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"tVec", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
         RowBox[{"Coords", "[", 
          RowBox[{"[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], "/@", 
       "NeumannPoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDArray", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"ndof", "*", "nnp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IDMat", "=", 
      SuperscriptBox[
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"IDArray", ",", 
         RowBox[{"{", 
          RowBox[{"nnp", ",", "ndof"}], "}"}]}], "]"}], "\[Transpose]"]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"IDno", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"IDArray", ",", "DirichletDof"}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8189805604215517`*^9, 3.8189805970193853`*^9}, {
   3.8189806402760077`*^9, 3.818980645303714*^9}, {3.8189808010365458`*^9, 
   3.818980823844203*^9}, 3.818980860836404*^9, {3.8189809218409643`*^9, 
   3.818980937631098*^9}, {3.818980991616516*^9, 3.818981027663657*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"624ce4be-7dfc-486a-9bb8-6f96df0947d4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"L", "=", "2"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalEpsilon]", "=", "10"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[Nu]", "=", "0.499"}], ",", "\[IndentingNewLine]", 
      RowBox[{"RelaxFactor", " ", "=", " ", "1"}], ",", "\[IndentingNewLine]", 
      RowBox[{"uVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0.0", "&"}], ",", 
         RowBox[{"0.0", "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"tVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1.0", "&"}], ",", 
         RowBox[{
          RowBox[{"-", "1.0"}], "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      
      RowBox[{"TracInd", "=", "False"}], "\[IndentingNewLine]", ",", 
      RowBox[{"ConcenInd", "=", " ", "True"}]}], "\[IndentingNewLine]", "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mesh1", " ", "=", 
      RowBox[{"ToElementMesh", "[", 
       RowBox[{
        RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"\"\<MeshElements\>\"", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"TriangleElement", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}], 
          "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MaterialProperty", "=", 
      RowBox[{"InitializeFEM", "[", 
       RowBox[{"mesh1", ",", "\[CapitalEpsilon]", ",", "\[Nu]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DefineBCs2", "[", 
      RowBox[{"uVec", ",", "tVec", ",", "L"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "@", 
      RowBox[{"PlotMeshBC", "[", 
       RowBox[{"mesh1", ",", "DirichletPoints", ",", "NeumannPoints", ",", 
        RowBox[{"ShowMesh", "\[Rule]", "True"}], ",", 
        RowBox[{"ShowNumbers", "\[Rule]", "True"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"ShowBCs", "\[Rule]", "\"\<NeumannBC\>\""}]}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{",", 
         RowBox[{"ShowBCs", "\[Rule]", "\"\<DirichletBC\>\""}]}], "*)"}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Fd", "=", 
      RowBox[{"NewtonSolve", "[", 
       RowBox[{
       "1", ",", "1", ",", "RelaxFactor", ",", "TracInd", ",", "ConcenInd"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"Fd", ",", 
       RowBox[{"PostProcess", "[", 
        RowBox[{"Fd", ",", "mesh1"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.81893774675817*^9, 3.8189377884434853`*^9}, {
  3.818942086808752*^9, 3.818942216030859*^9}, {3.818942335755672*^9, 
  3.8189423610513697`*^9}, {3.818943289275324*^9, 3.818943309267523*^9}, {
  3.8189434864568653`*^9, 3.818943487405658*^9}, {3.818943909749308*^9, 
  3.818943919571897*^9}, {3.818980480708255*^9, 3.818980529059619*^9}, {
  3.818980694498489*^9, 3.818980705303822*^9}, {3.818980791721322*^9, 
  3.818980796618577*^9}, {3.818981045224906*^9, 3.818981056426818*^9}, {
  3.818981308253881*^9, 3.818981360074478*^9}, {3.819026154393626*^9, 
  3.8190261624778748`*^9}, {3.819036097947435*^9, 3.8190361003281193`*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"1e6f8a0c-173e-4591-bfe8-2d836974a803"],

Cell[CellGroupData[{

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 4}, {2, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PolygonBox[{{1, 2, 4}, {2, 3, 4}}], 
      {RGBColor[0, 0, 1], 
       InsetBox["1", {0.6666666666666666, 0.6666666666666666}, 
        ImageScaled[{0, 0}]], 
       InsetBox["2", {1.3333333333333333, 1.3333333333333333}, 
        ImageScaled[{0, 0}]]}}]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PointBox[{1, 2, 3, 4}], 
      {RGBColor[1, 0, 0], InsetBox["1", {0., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["2", {2., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["3", {2., 2.}, ImageScaled[{0, 0}]], 
       InsetBox["4", {0., 2.}, ImageScaled[{0, 0}]]}}]}, 
   {RGBColor[1, 0.5, 0], PointSize[Large], PointBox[{{2., 2.}}]}, 
   {RGBColor[0, 1, 0], PointSize[Large], PointBox[{{2., 2.}}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.819036102771968*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"e11bc459-b966-42ab-b5ff-da07ff78b171"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Step No. = \"\>", "\[InvisibleSpace]", "1"}],
  SequenceForm["Step No. = ", 1],
  Editable->False]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.819036102776739*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"b19d340d-eadc-4a7d-9912-7c0e8e92c6ec"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"LoadFactor = \"\>", "\[InvisibleSpace]", "1.`"}],
  SequenceForm["LoadFactor = ", 1.],
  Editable->False]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.819036102779817*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"88a4a436-036a-4571-9913-28d87e4a27a5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", "0.`", ",", "0.`", ",", "0.`", ",", "1.`", ",", 
   RowBox[{"-", "1.`"}], ",", "0.`", ",", "0.`"}], "}"}]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.81903610282522*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"af16bc08-ca54-43f7-8090-fb5a7db3b0ae"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Iteration: \"\>", "\[InvisibleSpace]", "1", 
   "\[InvisibleSpace]", "\<\". \\n Norm of residual for u : \"\>", 
   "\[InvisibleSpace]", "2.5979218776228663`*^-14"}],
  SequenceForm[
  "Iteration: ", 1, ". \n Norm of residual for u : ", 
   2.5979218776228663`*^-14],
  Editable->False]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.819036102862975*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"55f9fe84-2cdf-462d-9373-b26f33e60d0c"],

Cell[BoxData["\<\"Compute u Converged!\"\>"], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.8190361028683443`*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"359f4eda-823c-4c74-a63b-b3456212ee0a"],

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 4}, {2, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2.2997999999999923`, 
     1.7002000000000077`}, {0., 2.}}, 
     {EdgeForm[RGBColor[1, 0, 0]], PolygonBox[{{1, 2, 4}, {2, 3, 4}}]}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{3.8190255970910873`*^9, 3.819026163056019*^9, 
  3.8190361028983097`*^9},
 CellLabel->
  "During evaluation of \
In[56]:=",ExpressionUUID->"9420010d-a341-44ee-9f8c-8bf2b2189246"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.`", ",", "0.`", ",", "0.29979999999999224`", ",", "0.`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.`", ",", "0.`", ",", 
         RowBox[{"-", "0.29979999999999224`"}], ",", "0.`"}], "}"}]}], "}"}], 
     "}"}], "}"}], ",", 
   RowBox[{"-", "0.29979999999999224`"}]}], "}"}]], "Output",
 CellChangeTimes->{3.819025597247731*^9, 3.81902616310577*^9, 
  3.8190361029055643`*^9},
 CellLabel->"Out[56]=",ExpressionUUID->"5c4c6070-86de-43b7-be3f-8ed37b530a6b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"  ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"L", "=", "2"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalEpsilon]", "=", "10"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[Nu]", "=", "0.499"}], ",", "\[IndentingNewLine]", 
      RowBox[{"RelaxFactor", " ", "=", " ", "1"}], ",", "\[IndentingNewLine]", 
      RowBox[{"uVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0.0", "&"}], ",", 
         RowBox[{"0.0", "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"tVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1.0", "&"}], ",", 
         RowBox[{
          RowBox[{"-", "1.0"}], "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      
      RowBox[{"TracInd", "=", "False"}], "\[IndentingNewLine]", ",", 
      RowBox[{"ConcenInd", "=", " ", "True"}]}], "\[IndentingNewLine]", "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mesh2", " ", "=", 
      RowBox[{"ToElementMesh", "[", 
       RowBox[{
        RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"\"\<MeshElements\>\"", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"TriangleElement", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}], 
          "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MaterialProperty", "=", 
      RowBox[{"InitializeFEM", "[", 
       RowBox[{"mesh2", ",", "\[CapitalEpsilon]", ",", "\[Nu]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DefineBCs2", "[", 
      RowBox[{"uVec", ",", "tVec", ",", "L"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "@", 
      RowBox[{"PlotMeshBC", "[", 
       RowBox[{"mesh2", ",", "DirichletPoints", ",", "NeumannPoints", ",", 
        RowBox[{"ShowMesh", "\[Rule]", "True"}], ",", 
        RowBox[{"ShowNumbers", "\[Rule]", "True"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"ShowBCs", "\[Rule]", "\"\<NeumannBC\>\""}]}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{",", 
         RowBox[{"ShowBCs", "\[Rule]", "\"\<DirichletBC\>\""}]}], "*)"}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Fd", "=", 
      RowBox[{"NewtonSolve", "[", 
       RowBox[{
       "1", ",", "1", ",", "RelaxFactor", ",", "TracInd", ",", "ConcenInd"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"Fd", ",", 
       RowBox[{"PostProcess", "[", 
        RowBox[{"Fd", ",", "mesh2"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.818943314057391*^9, 3.818943321450232*^9}, {
  3.818943352154839*^9, 3.818943357130124*^9}, {3.81894347467246*^9, 
  3.818943476348816*^9}, {3.8189438271961813`*^9, 3.81894383395562*^9}, {
  3.81898108921099*^9, 3.818981113723139*^9}, {3.818981386141779*^9, 
  3.818981396374991*^9}, {3.819026182669977*^9, 3.819026184334352*^9}, {
  3.8190361075781517`*^9, 3.819036110338257*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"ee261ccd-268c-4551-8411-989a26814dd2"],

Cell[CellGroupData[{

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 3}, {1, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PolygonBox[{{1, 2, 3}, {1, 3, 4}}], 
      {RGBColor[0, 0, 1], 
       InsetBox["1", {1.3333333333333333, 0.6666666666666666}, 
        ImageScaled[{0, 0}]], 
       InsetBox["2", {0.6666666666666666, 1.3333333333333333}, 
        ImageScaled[{0, 0}]]}}]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PointBox[{1, 2, 3, 4}], 
      {RGBColor[1, 0, 0], InsetBox["1", {0., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["2", {2., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["3", {2., 2.}, ImageScaled[{0, 0}]], 
       InsetBox["4", {0., 2.}, ImageScaled[{0, 0}]]}}]}, 
   {RGBColor[1, 0.5, 0], PointSize[Large], PointBox[{{2., 2.}}]}, 
   {RGBColor[0, 1, 0], PointSize[Large], PointBox[{{2., 2.}}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110756269*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"018336ab-4034-48d8-873c-a25ad5ac1e45"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Step No. = \"\>", "\[InvisibleSpace]", "1"}],
  SequenceForm["Step No. = ", 1],
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110760523*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"70ade41f-95e0-47c9-8c82-c13ba6eb42d9"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"LoadFactor = \"\>", "\[InvisibleSpace]", "1.`"}],
  SequenceForm["LoadFactor = ", 1.],
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110763309*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"98577199-bda0-4d1e-a618-317e3fb7de80"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", "0.`", ",", "0.`", ",", "0.`", ",", "1.`", ",", 
   RowBox[{"-", "1.`"}], ",", "0.`", ",", "0.`"}], "}"}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110767867*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"57570ba6-6d3e-470b-b7ba-a1d3f36fc8a3"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Iteration: \"\>", "\[InvisibleSpace]", "1", 
   "\[InvisibleSpace]", "\<\". \\n Norm of residual for u : \"\>", 
   "\[InvisibleSpace]", "0.`"}],
  SequenceForm["Iteration: ", 1, ". \n Norm of residual for u : ", 0.],
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110809681*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"a31b5289-f3bc-4b01-98b2-765332c33d04"],

Cell[BoxData["\<\"Compute u Converged!\"\>"], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.8190361108118973`*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"e68b379d-cdf7-4295-bb0c-7e466d2479b7"],

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 3}, {1, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2.001194422310757, 
     1.998805577689243}, {0., 2.}}, 
     {EdgeForm[RGBColor[1, 0, 0]], PolygonBox[{{1, 2, 3}, {1, 3, 4}}]}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.818981396732273*^9, 3.819026184640521*^9, 3.819036110816023*^9},
 CellLabel->
  "During evaluation of \
In[57]:=",ExpressionUUID->"a4cbdae2-bea6-4a5f-905f-5590c21bcaa4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.`", ",", "0.`", ",", "0.0011944223107569732`", ",", "0.`"}], "}"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"0.`", ",", "0.`", ",", 
         RowBox[{"-", "0.0011944223107569732`"}], ",", "0.`"}], "}"}]}], 
      "}"}], "}"}], "}"}], ",", 
   RowBox[{"-", "0.0011944223107569732`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.818943357989781*^9, 3.818943367621051*^9}, 
   3.8189434151809177`*^9, {3.818943476928384*^9, 3.818943482131936*^9}, {
   3.818943827779378*^9, 3.8189438343463087`*^9}, 3.818981114044972*^9, 
   3.818981396751594*^9, 3.819026184666967*^9, 3.8190361108238087`*^9},
 CellLabel->"Out[57]=",ExpressionUUID->"a5f40606-5408-43e2-a57e-a97c3f432e7f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"  ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"L", "=", "2"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalEpsilon]", "=", "10"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\[Nu]", "=", "0.499"}], ",", "\[IndentingNewLine]", 
      RowBox[{"RelaxFactor", " ", "=", " ", "1"}], ",", "\[IndentingNewLine]", 
      RowBox[{"uVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0.0", "&"}], ",", 
         RowBox[{"0.0", "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"tVec", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"10.0", "&"}], ",", 
         RowBox[{"8.0", "&"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"TracInd", "=", "False"}], "\[IndentingNewLine]", ",", 
      RowBox[{"ConcenInd", "=", " ", "True"}]}], "\[IndentingNewLine]", "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mesh3", " ", "=", 
      RowBox[{"ToElementMesh", "[", 
       RowBox[{
        RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "2"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"\"\<MeshElements\>\"", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"TriangleElement", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}], 
          "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MaterialProperty", "=", 
      RowBox[{"InitializeFEM", "[", 
       RowBox[{"mesh3", ",", "\[CapitalEpsilon]", ",", "\[Nu]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DefineBCs2", "[", 
      RowBox[{"uVec", ",", "tVec", ",", "L"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "@", 
      RowBox[{"PlotMeshBC", "[", 
       RowBox[{"mesh3", ",", "DirichletPoints", ",", "NeumannPoints", ",", 
        RowBox[{"ShowMesh", "\[Rule]", "True"}], ",", 
        RowBox[{"ShowNumbers", "\[Rule]", "True"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"ShowBCs", "\[Rule]", "\"\<NeumannBC\>\""}]}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{",", 
         RowBox[{"ShowBCs", "\[Rule]", "\"\<DirichletBC\>\""}]}], "*)"}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Fd", "=", 
      RowBox[{"NewtonSolve", "[", 
       RowBox[{
       "1", ",", "1", ",", "RelaxFactor", ",", "TracInd", ",", "ConcenInd"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"Fd", ",", 
       RowBox[{"PostProcess", "[", 
        RowBox[{"Fd", ",", "mesh3"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.818943314057391*^9, 3.818943321450232*^9}, {
  3.818943352154839*^9, 3.818943357130124*^9}, {3.81894347467246*^9, 
  3.818943476348816*^9}, {3.8189438271961813`*^9, 3.81894383395562*^9}, {
  3.81898108921099*^9, 3.818981113723139*^9}, {3.8189811531794777`*^9, 
  3.818981176966728*^9}, {3.8189812123036337`*^9, 3.818981220823594*^9}, {
  3.8189814115446033`*^9, 3.818981423815728*^9}, {3.819026196605242*^9, 
  3.81902619801477*^9}, {3.81903611449229*^9, 3.819036116593227*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"6836c6ed-220e-43ff-b551-db07a66e9eb7"],

Cell[CellGroupData[{

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 4}, {2, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PolygonBox[{{1, 2, 4}, {2, 3, 4}}], 
      {RGBColor[0, 0, 1], 
       InsetBox["1", {0.6666666666666666, 0.6666666666666666}, 
        ImageScaled[{0, 0}]], 
       InsetBox["2", {1.3333333333333333, 1.3333333333333333}, 
        ImageScaled[{0, 0}]]}}]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 
     2.}}, {PointBox[{1, 2, 3, 4}], 
      {RGBColor[1, 0, 0], InsetBox["1", {0., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["2", {2., 0.}, ImageScaled[{0, 0}]], 
       InsetBox["3", {2., 2.}, ImageScaled[{0, 0}]], 
       InsetBox["4", {0., 2.}, ImageScaled[{0, 0}]]}}]}, 
   {RGBColor[1, 0.5, 0], PointSize[Large], PointBox[{{2., 2.}}]}, 
   {RGBColor[0, 1, 0], PointSize[Large], PointBox[{{2., 2.}}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.819036116952334*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"a2f8ea8a-0ea5-4112-ada9-9aef51d0a3e6"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Step No. = \"\>", "\[InvisibleSpace]", "1"}],
  SequenceForm["Step No. = ", 1],
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.819036116956555*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"2edea733-2620-4c37-b3c1-ac013311b28f"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"LoadFactor = \"\>", "\[InvisibleSpace]", "1.`"}],
  SequenceForm["LoadFactor = ", 1.],
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.8190361169594107`*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"63cb4e07-9d29-47f2-a2e8-a477042fd817"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.`", ",", "0.`", ",", "0.`", ",", "0.`", ",", "10.`", ",", "8.`", ",", 
   "0.`", ",", "0.`"}], "}"}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.819036116961178*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"726bbc81-03ce-4499-98b7-5adc39740104"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Iteration: \"\>", "\[InvisibleSpace]", "1", 
   "\[InvisibleSpace]", "\<\". \\n Norm of residual for u : \"\>", 
   "\[InvisibleSpace]", "3.907985046680551`*^-14"}],
  SequenceForm[
  "Iteration: ", 1, ". \n Norm of residual for u : ", 3.907985046680551*^-14],
  
  Editable->False]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.819036116998438*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"7fbc03f1-a7b3-44e1-900d-39fae535c697"],

Cell[BoxData["\<\"Compute u Converged!\"\>"], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.81903611700091*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"c0c6a64a-d5b9-4726-9f9f-eba8fc274d77"],

Cell[BoxData[
 GraphicsBox[{
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2., 2.}, {0., 2.}}, 
     PolygonBox[{{1, 2, 4}, {2, 3, 4}}]]}, 
   {EdgeForm[GrayLevel[0]], FaceForm[None], 
    GraphicsComplexBox[{{0., 0.}, {2., 0.}, {2.305185628742507, 
     1.7055856287425226`}, {0., 2.}}, 
     {EdgeForm[RGBColor[1, 0, 0]], PolygonBox[{{1, 2, 4}, {2, 3, 4}}]}]}},
  ViewPoint -> {1.5, 1, 1}]], "Print",
 CellChangeTimes->{{3.818943357890049*^9, 3.8189433675350103`*^9}, 
   3.818943415080536*^9, {3.818943476815464*^9, 3.818943482050232*^9}, {
   3.81894382766555*^9, 3.818943834238949*^9}, 3.818981114000647*^9, 
   3.8189812226879587`*^9, {3.8189814128436947`*^9, 3.8189814241447477`*^9}, 
   3.819026198287239*^9, 3.819036117005821*^9},
 CellLabel->
  "During evaluation of \
In[58]:=",ExpressionUUID->"acd4ba87-2d43-455f-81ad-46c80d499a11"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.`", ",", "0.`", ",", "0.30518562874250726`", ",", "0.`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.`", ",", "0.`", ",", 
         RowBox[{"-", "0.2944143712574773`"}], ",", "0.`"}], "}"}]}], "}"}], 
     "}"}], "}"}], ",", 
   RowBox[{"-", "0.34827065868262275`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.818943357989781*^9, 3.818943367621051*^9}, 
   3.8189434151809177`*^9, {3.818943476928384*^9, 3.818943482131936*^9}, {
   3.818943827779378*^9, 3.8189438343463087`*^9}, 3.818981114044972*^9, 
   3.818981222746936*^9, {3.8189814129208813`*^9, 3.818981424159189*^9}, 
   3.819026198312787*^9, 3.819036117013359*^9},
 CellLabel->"Out[58]=",ExpressionUUID->"25dfd58e-14ee-428f-abaa-9e81aff8b8f8"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1280, 699},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (March 18, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"7d9cead4-af62-4bdc-aadc-8f73ff0aacbc"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[1486, 35, 223, 4, 98, "Title",ExpressionUUID->"ba979db3-0d81-4b25-aece-bc7347ec6e88"],
Cell[CellGroupData[{
Cell[1734, 43, 127, 2, 67, "Section",ExpressionUUID->"39740111-5994-46ae-b122-2ecea0d8fc03",
 InitializationCell->True],
Cell[1864, 47, 2213, 58, 299, "Input",ExpressionUUID->"f13c2ac7-6f36-4377-b4a4-b9f59cdc3109",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[4102, 109, 1365, 25, 152, "Input",ExpressionUUID->"15d1034f-f579-4da1-8e5f-d4922a9a75b4",
 InitializationCell->True],
Cell[5470, 136, 683, 10, 34, "Output",ExpressionUUID->"f5e85cc7-a42d-4bca-9467-987df26bd7ff"]
}, Open  ]],
Cell[6168, 149, 9229, 215, 866, "Input",ExpressionUUID->"83f6da20-202e-4799-bc57-3420348dd756",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[15434, 369, 274, 6, 67, "Section",ExpressionUUID->"130d897e-c75f-4858-aa37-bf3a2be32e6f",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[15733, 379, 268, 5, 54, "Subsection",ExpressionUUID->"c7d98378-1c8c-4c0c-9cdd-7c9ebac71b21",
 InitializationCell->True],
Cell[16004, 386, 21329, 530, 1065, "Input",ExpressionUUID->"d001b27c-9aad-47e5-b41f-c679d423578d",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[37370, 921, 164, 3, 54, "Subsection",ExpressionUUID->"4a9a92f0-59be-4b38-9fbd-8ed3f91230aa"],
Cell[37537, 926, 7273, 178, 614, "Input",ExpressionUUID->"98d46118-fccd-42e9-a104-64bd1a74173f",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[44847, 1109, 278, 5, 54, "Subsection",ExpressionUUID->"063a9aa6-8702-40e0-94a8-0d87520eb80b",
 InitializationCell->True],
Cell[45128, 1116, 12959, 246, 637, "Input",ExpressionUUID->"78f28d6b-52e4-4baf-991a-20c8d0d8ed15",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[58124, 1367, 273, 5, 54, "Subsection",ExpressionUUID->"ca2ed7d2-70d5-4084-b8f4-66d5518f62c8",
 InitializationCell->True],
Cell[58400, 1374, 4140, 99, 341, "Input",ExpressionUUID->"d68b8b31-45a4-4d5a-8485-f9010a05fb83",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[62565, 1477, 21374, 467, 981, "Input",ExpressionUUID->"9907f5e7-58f0-41ac-b2cf-2df32d04c990",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True],
Cell[83942, 1946, 17819, 355, 1055, "Input",ExpressionUUID->"ef661214-6651-46b2-883d-cd6f9da4f8c5",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[101810, 2307, 174, 3, 54, "Subsection",ExpressionUUID->"b68a3e68-51b1-40a3-928c-18feccf2aee8"],
Cell[CellGroupData[{
Cell[102009, 2314, 10880, 277, 971, "Input",ExpressionUUID->"c90ca03f-4b88-471f-a9c5-98a6503d47f4",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True],
Cell[112892, 2593, 8436, 206, 662, "Input",ExpressionUUID->"17788649-0f79-4cfe-9df3-239aa542d934",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[121377, 2805, 173, 3, 54, "Subsection",ExpressionUUID->"863735f3-6534-4c41-a20f-9d33e1f41e8e"],
Cell[121553, 2810, 10765, 255, 719, "Input",ExpressionUUID->"016bef08-dff2-4bcb-90d7-efc44ba52b8e",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[132355, 3070, 324, 6, 54, "Subsection",ExpressionUUID->"6f3e87a4-9fef-4dc2-b391-5d0fb57f61ae",
 InitializationCell->True],
Cell[132682, 3078, 2367, 67, 246, "Input",ExpressionUUID->"383a8d38-076d-4ce4-9063-0eceadb341d9"],
Cell[135052, 3147, 15112, 304, 871, "Input",ExpressionUUID->"d0da422e-6d14-4ba6-a5ab-d786f28cdf2d",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[150167, 3453, 3537, 94, 480, "Input",ExpressionUUID->"d8ce27f8-772b-4375-a4a7-86c77348b64b"]
}, Closed]],
Cell[CellGroupData[{
Cell[153741, 3552, 353, 6, 38, "Subsection",ExpressionUUID->"54d6952a-b370-41dc-b8d8-ea6b81166a2e",
 InitializationCell->True],
Cell[154097, 3560, 13908, 278, 693, "Input",ExpressionUUID->"8af358d9-2e76-43ff-a436-9f72e8c83cf5",
 InitializationCell->True],
Cell[168008, 3840, 11704, 251, 1015, "Input",ExpressionUUID->"54ece23b-6e14-4698-886c-04e54342e536",
 InitializationCell->True],
Cell[179715, 4093, 7076, 193, 450, "Input",ExpressionUUID->"624ce4be-7dfc-486a-9bb8-6f96df0947d4",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[186816, 4290, 3854, 88, 409, "Input",ExpressionUUID->"1e6f8a0c-173e-4591-bfe8-2d836974a803"],
Cell[CellGroupData[{
Cell[190695, 4382, 1306, 27, 374, "Print",ExpressionUUID->"e11bc459-b966-42ab-b5ff-da07ff78b171"],
Cell[192004, 4411, 354, 9, 24, "Print",ExpressionUUID->"b19d340d-eadc-4a7d-9912-7c0e8e92c6ec"],
Cell[192361, 4422, 361, 9, 24, "Print",ExpressionUUID->"88a4a436-036a-4571-9913-28d87e4a27a5"],
Cell[192725, 4433, 362, 8, 24, "Print",ExpressionUUID->"af16bc08-ca54-43f7-8090-fb5a7db3b0ae"],
Cell[193090, 4443, 542, 13, 45, "Print",ExpressionUUID->"55f9fe84-2cdf-462d-9373-b26f33e60d0c"],
Cell[193635, 4458, 252, 5, 24, "Print",ExpressionUUID->"359f4eda-823c-4c74-a63b-b3456212ee0a"],
Cell[193890, 4465, 646, 14, 322, "Print",ExpressionUUID->"9420010d-a341-44ee-9f8c-8bf2b2189246"]
}, Open  ]],
Cell[194551, 4482, 626, 17, 34, "Output",ExpressionUUID->"5c4c6070-86de-43b7-be3f-8ed37b530a6b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[195214, 4504, 3608, 85, 409, "Input",ExpressionUUID->"ee261ccd-268c-4551-8411-989a26814dd2"],
Cell[CellGroupData[{
Cell[198847, 4593, 1496, 29, 374, "Print",ExpressionUUID->"018336ab-4034-48d8-873c-a25ad5ac1e45"],
Cell[200346, 4624, 544, 11, 24, "Print",ExpressionUUID->"70ade41f-95e0-47c9-8c82-c13ba6eb42d9"],
Cell[200893, 4637, 551, 11, 24, "Print",ExpressionUUID->"98577199-bda0-4d1e-a618-317e3fb7de80"],
Cell[201447, 4650, 553, 10, 24, "Print",ExpressionUUID->"57570ba6-6d3e-470b-b7ba-a1d3f36fc8a3"],
Cell[202003, 4662, 682, 13, 44, "Print",ExpressionUUID->"a31b5289-f3bc-4b01-98b2-765332c33d04"],
Cell[202688, 4677, 442, 7, 24, "Print",ExpressionUUID->"e68b379d-cdf7-4295-bb0c-7e466d2479b7"],
Cell[203133, 4686, 830, 16, 367, "Print",ExpressionUUID->"a4cbdae2-bea6-4a5f-905f-5590c21bcaa4"]
}, Open  ]],
Cell[203978, 4705, 837, 20, 34, "Output",ExpressionUUID->"a5f40606-5408-43e2-a57e-a97c3f432e7f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[204852, 4730, 3673, 84, 409, "Input",ExpressionUUID->"6836c6ed-220e-43ff-b551-db07a66e9eb7"],
Cell[CellGroupData[{
Cell[208550, 4818, 1552, 30, 374, "Print",ExpressionUUID->"a2f8ea8a-0ea5-4112-ada9-9aef51d0a3e6"],
Cell[210105, 4850, 600, 12, 24, "Print",ExpressionUUID->"2edea733-2620-4c37-b3c1-ac013311b28f"],
Cell[210708, 4864, 609, 12, 24, "Print",ExpressionUUID->"63cb4e07-9d29-47f2-a2e8-a477042fd817"],
Cell[211320, 4878, 598, 12, 24, "Print",ExpressionUUID->"726bbc81-03ce-4499-98b7-5adc39740104"],
Cell[211921, 4892, 784, 16, 45, "Print",ExpressionUUID->"7fbc03f1-a7b3-44e1-900d-39fae535c697"],
Cell[212708, 4910, 495, 8, 24, "Print",ExpressionUUID->"c0c6a64a-d5b9-4726-9f9f-eba8fc274d77"],
Cell[213206, 4920, 888, 17, 322, "Print",ExpressionUUID->"acd4ba87-2d43-455f-81ad-46c80d499a11"]
}, Open  ]],
Cell[214109, 4940, 871, 20, 34, "Output",ExpressionUUID->"25dfd58e-14ee-428f-abaa-9e81aff8b8f8"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

